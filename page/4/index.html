<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Hexo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://blog.heshipeng.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="æ‹¾å…‰çš„ç¢ç¾½">
<meta name="twitter:card" content="summary">
    
        <link rel="alternate" type="application/atom+xml" title="Hexo" href="/atom.xml">
    
    <link rel="shortcut icon" href="https://img.heshipeng.com/202205092054351.png">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(https://img.heshipeng.com/202205092044923.jpeg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://img.heshipeng.com/202205092042366.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">æ‹¾å…‰çš„ç¢ç¾½</h5>
          <a href="mailto:1615433864@qq.com" title="1615433864@qq.com" class="mail">1615433864@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Hexo</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header index-header">

    <div class="container fade-scale">
        <h1 class="title">Hexo</h1>
        <h5 class="subtitle">
            
                
            
        </h5>
    </div>

    


</header>

<div class="container body-wrap">

    <ul class="post-list">
    
        <li class="post-list-item fade">
            <article id="post-Androidé€†å‘ä¹‹åŠ¨æ€åŠ è½½"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2022-01-15 23:40:22" datetime="2022-01-15T15:40:22.000Z"  itemprop="datePublished">2022-01-15</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/">Androidé€†å‘ä¹‹åŠ¨æ€åŠ è½½</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <div align="middle"><iframe width="560" height="315" src="https://www.youtube.com/embed/k7akz2hdToY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>



<h3 id="åŠ¨æ€åŠ è½½"><a href="#åŠ¨æ€åŠ è½½" class="headerlink" title="åŠ¨æ€åŠ è½½"></a>åŠ¨æ€åŠ è½½</h3><p>å¼€å§‹æ­£é¢˜ä¹‹å‰ï¼Œåœ¨è¿™é‡Œå¯ä»¥å…ˆç»™åŠ¨æ€åŠ è½½æŠ€æœ¯åšä¸€ä¸ªç®€å•çš„å®šä¹‰ã€‚çœŸæ­£çš„åŠ¨æ€åŠ è½½åº”è¯¥æ˜¯</p>
<ol>
<li>åº”ç”¨åœ¨è¿è¡Œçš„æ—¶å€™é€šè¿‡åŠ è½½ä¸€äº›<strong>æœ¬åœ°ä¸å­˜åœ¨</strong>çš„å¯æ‰§è¡Œæ–‡ä»¶å®ç°ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ã€‚</li>
<li>è¿™äº›å¯æ‰§è¡Œæ–‡ä»¶æ˜¯<strong>å¯ä»¥æ›¿æ¢</strong>çš„ã€‚</li>
<li>æ›´æ¢é™æ€èµ„æº(æ¯”å¦‚æ¢å¯åŠ¨å›¾ã€æ¢ä¸»é¢˜ã€æˆ–è€…ç”¨æœåŠ¡å™¨å‚æ•°å¼€å…³æ§åˆ¶å¹¿å‘Šçš„éšè—ç°å®ç­‰)<strong>ä¸å±äº</strong>åŠ¨æ€åŠ è½½ã€‚</li>
<li><code>Android</code>ä¸­åŠ¨æ€åŠ è½½çš„æ ¸å¿ƒæ€æƒ³æ˜¯åŠ¨æ€è°ƒç”¨å¤–éƒ¨çš„ <strong><code>dex</code>æ–‡ä»¶</strong>ï¼Œæç«¯çš„æƒ…å†µä¸‹ï¼Œ<code>Android APK</code>è‡ªèº«å¸¦æœ‰çš„<code>Dex</code>æ–‡ä»¶åªæ˜¯ä¸€ä¸ªç¨‹åºçš„å…¥å£(æˆ–è€…è¯´ç©ºå£³)ï¼Œæ‰€æœ‰çš„åŠŸèƒ½éƒ½é€šè¿‡ä»æœåŠ¡å™¨ä¸‹è½½æœ€æ–°çš„<code>Dex</code>æ–‡ä»¶å®Œæˆã€‚</li>
</ol>
<h3 id="ä¸¤ä¸ªç–‘é—®ğŸ¤”"><a href="#ä¸¤ä¸ªç–‘é—®ğŸ¤”" class="headerlink" title="ä¸¤ä¸ªç–‘é—®ğŸ¤”"></a>ä¸¤ä¸ªç–‘é—®ğŸ¤”</h3><p>æå‡ºä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ï¼Œå¦‚ä½•åœ¨<code>Android</code>ç¨‹åºä¸­åŠ è½½å¤–éƒ¨<code>dex</code>çš„<code>class</code>ï¼›ç¬¬äºŒï¼Œå¯¹äºæœ‰ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶(æ¯”å¦‚Activityè¿™ç§ç±»)è¯¥å¦‚ä½•åŠ è½½ï¼Ÿæœ¬æ–‡çš„ç›®çš„å°±æ˜¯é€šè¿‡è§£å†³è¿™2ä¸ªé—®é¢˜ä»è€Œå¯¹<code>Android</code>çš„åŠ¨æ€åŠ è½½æŠ€æœ¯æœ‰ä¸€å®šçš„äº†è§£ã€‚</p>
<h3 id="ç±»åŠ è½½å™¨ä¸åŒäº²å§”æ´¾"><a href="#ç±»åŠ è½½å™¨ä¸åŒäº²å§”æ´¾" class="headerlink" title="ç±»åŠ è½½å™¨ä¸åŒäº²å§”æ´¾"></a>ç±»åŠ è½½å™¨ä¸åŒäº²å§”æ´¾</h3><p>è¦è§£å†³è¿™ä¿©é—®é¢˜ï¼Œé¦–å…ˆè¦äº†è§£å‡ ä¸ªæ¦‚å¿µã€‚</p>
<h4 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h4><p>ç±»åŠ è½½å™¨é¡¾åæ€ä¹‰æ˜¯ç”¨æ¥è¿›è¡Œç±»çš„åŠ è½½ã€‚åˆ†åˆ«çœ‹ä¸‹JVMçš„ç±»åŠ è½½å™¨å’ŒAndroidçš„ç±»åŠ è½½å™¨ã€‚</p>
<h5 id="JVMçš„ç±»åŠ è½½å™¨"><a href="#JVMçš„ç±»åŠ è½½å™¨" class="headerlink" title="JVMçš„ç±»åŠ è½½å™¨"></a>JVMçš„ç±»åŠ è½½å™¨</h5><p>JVMçš„ç±»åŠ è½½å™¨åŒ…æ‹¬3ç§ï¼š</p>
<ol>
<li>Bootstrap ClassLoader(å¼•å¯¼ç±»åŠ è½½å™¨)</li>
</ol>
<p>C/C++ä»£ç å®ç°çš„åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½æŒ‡å®šçš„JDKçš„æ ¸å¿ƒç±»åº“ï¼Œæ¯”å¦‚java.langï¼Œjava.utilç­‰è¿™äº›ç³»ç»Ÿç±»ã€‚Javaè™šæ‹Ÿæœºçš„å¯åŠ¨å°±æ˜¯é€šè¿‡Bootstrapï¼Œè¯¥Classloaderåœ¨javaé‡Œæ— æ³•è·å–ï¼Œè´Ÿè´£åŠ è½½/libä¸‹çš„ç±»ã€‚</p>
<ol>
<li>Extensions ClassLoader(æ‹“å±•ç±»åŠ è½½å™¨)</li>
</ol>
<p>Javaä¸­çš„å®ç°ç±»ä¸ºExtClassLoaderï¼Œæä¾›äº†é™¤äº†ç³»ç»Ÿç±»ä¹‹å¤–çš„é¢å¤–åŠŸèƒ½ï¼Œå¯ä»¥åœ¨Javaé‡Œè·å–ï¼Œè´Ÿè´£åŠ è½½/lib/extä¸‹çš„ç±»ã€‚</p>
<ol>
<li>Application ClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)</li>
</ol>
<p>Javaä¸­çš„å®ç°ç±»ä¸ºAppClassLoaderï¼Œæ˜¯ä¸æˆ‘ä»¬æ¥è§¦æœ€å¤šçš„ç±»åŠ è½½å™¨ï¼Œå¼€å‘äººå‘˜å†™çš„ä»£ç é»˜è®¤å°±æ˜¯ç”±å®ƒæ¥åŠ è½½ï¼ŒClassLoader.getSystemCLassLoaderè¿”å›çš„å°±æ˜¯å®ƒã€‚</p>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œåªéœ€è¦é€šè¿‡ç»§æ‰¿java.lang.ClassLoaderç±»çš„æ–¹å¼æ¥å®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨å³å¯ã€‚</p>
<h5 id="Androidä¸­çš„ç±»åŠ è½½å™¨"><a href="#Androidä¸­çš„ç±»åŠ è½½å™¨" class="headerlink" title="Androidä¸­çš„ç±»åŠ è½½å™¨"></a>Androidä¸­çš„ç±»åŠ è½½å™¨</h5><p>é¦–å…ˆé€šè¿‡ä¸€å¼ å›¾ï¼Œäº†è§£å„ä¸ªåŠ è½½å™¨ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131046618.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image" title="">
                </div>
                <div class="image-caption">image</div>
            </figure>
<p>è¯¦ç»†çœ‹ä¸‹å„ä¸ªç±»åŠ è½½å™¨çš„ä½œç”¨ï¼š</p>
<ol>
<li>ClassLoaderä¸ºæŠ½è±¡ç±»ï¼›</li>
<li>BootClassLoaderé¢„åŠ è½½å¸¸ç”¨ç±»ï¼Œå•ä¾‹æ¨¡å¼ã€‚ä¸Javaä¸­çš„BootClassLoaderä¸åŒï¼Œå®ƒå¹¶ä¸æ˜¯ç”±C/C++ä»£ç å®ç°ï¼Œè€Œæ˜¯ç”±Javaå®ç°çš„ï¼›</li>
<li>BaseDexClassLoaderæ˜¯PathClassLoader, DexClassLoader, InMemoryDexClassLoaderçš„çˆ¶ç±»ï¼Œç±»åŠ è½½çš„ä¸»è¦é€»è¾‘éƒ½æ˜¯åœ¨BaseDexClassLoaderå®Œæˆçš„ï¼›</li>
<li><p>SecureClassLoaderç»§æ‰¿äº†æŠ½è±¡ç±»ClassLoaderï¼Œæ‹“å±•äº†ClassLoaderç±»åŠ å…¥äº†æƒé™æ–¹é¢çš„åŠŸèƒ½ï¼ŒåŠ å¼ºäº†å®‰å…¨æ€§ï¼Œå…¶å­ç±»URLClassLoaderæ˜¯ç”¨URLè·¯å¾„ä»jaræ–‡ä»¶ä¸­åŠ è½½ç±»å’Œèµ„æºã€‚</p>
</li>
<li><p>PathClassLoaderæ˜¯Androidé»˜è®¤ä½¿ç”¨çš„ç±»åŠ è½½å™¨ï¼Œä¸€ä¸ªapkä¸­çš„Activityç­‰ç±»ä¾¿æ˜¯åœ¨å…¶ä¸­åŠ è½½ã€‚</p>
</li>
<li><p>DexClassLoaderå¯ä»¥åŠ è½½ä»»æ„ç›®å½•ä¸‹çš„dex/jar/apk/zipæ–‡ä»¶ï¼Œæ¯”PathClassLoaderæ›´çµæ´»ï¼Œæ˜¯å®ç°æ’ä»¶åŒ–ï¼Œçƒ­ä¿®å¤ä»¥åŠdexåŠ å£³çš„é‡ç‚¹ã€‚</p>
</li>
<li><p>InMemoryDexClassLoaderæ˜¯8.0å¼•å…¥çš„ï¼Œæ˜¯ç”¨äºç›´æ¥ä»å†…å­˜ä¸­åŠ è½½dexã€‚</p>
</li>
</ol>
<p>å…¶ä¸­é‡ç‚¹å…³æ³¨çš„æ˜¯ï¼šPathClassLoaderå’ŒDexClassLoaderï¼Œå› ä¸ºè¿™2ä¸ªç±»åŠ è½½å™¨æ˜¯æˆ‘ä»¬è§£å†³ä¸Šé¢2ä¸ªé—®é¢˜çš„å…³é”®ï¼Œä¹Ÿæ˜¯è¿™ä¸ªåŠ¨æ€åŠ è½½ä¸­éå¸¸é‡è¦çš„çš„ç±»åŠ è½½å™¨ã€‚</p>
<h5 id="ç±»åŠ è½½çš„æ—¶æœº"><a href="#ç±»åŠ è½½çš„æ—¶æœº" class="headerlink" title="ç±»åŠ è½½çš„æ—¶æœº"></a>ç±»åŠ è½½çš„æ—¶æœº</h5><ol>
<li>éšå¼åŠ è½½ã€‚</li>
</ol>
<ul>
<li>åˆ›å»ºç±»çš„å®ä¾‹ã€‚</li>
<li>è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œæˆ–è€…ä¸ºé™æ€å˜é‡èµ‹å€¼ã€‚</li>
<li>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ã€‚</li>
<li>ä½¿ç”¨åå°„æ–¹å¼æ¥å¼ºåˆ¶åˆ›å»ºæŸä¸ªç±»æˆ–è€…æ¥å£å¯¹åº”çš„java.lang.Classå¯¹è±¡ã€‚</li>
</ul>
<ol>
<li>æ˜¾å¼åŠ è½½ã€‚</li>
</ol>
<ul>
<li>ä½¿ç”¨LoadClass()åŠ è½½ã€‚</li>
<li>ä½¿ç”¨forName()åŠ è½½ã€‚</li>
</ul>
<h5 id="ç±»åŠ è½½çš„æ­¥éª¤"><a href="#ç±»åŠ è½½çš„æ­¥éª¤" class="headerlink" title="ç±»åŠ è½½çš„æ­¥éª¤"></a>ç±»åŠ è½½çš„æ­¥éª¤</h5><ol>
<li><p>è£…è½½ã€‚æŸ¥æ‰¾å’Œå¯¼å…¥Classæ–‡ä»¶ã€‚</p>
</li>
<li><p>é“¾æ¥ã€‚å…¶ä¸­è§£ææ­¥éª¤æ˜¯å¯ä»¥é€‰æ‹©çš„ã€‚</p>
</li>
<li><ul>
<li>æ£€æŸ¥ï¼šæ£€æŸ¥è½½å…¥çš„classæ–‡ä»¶æ•°æ®çš„æ­£ç¡®æ€§ã€‚</li>
<li>å‡†å¤‡ï¼šç»™ç±»çš„é™æ€å˜é‡åˆ†é…å­˜å‚¨ç©ºé—´ã€‚</li>
<li>è§£æï¼šå°†ç¬¦å·å¼•ç”¨è½¬æ¢æˆç›´æ¥å¼•ç”¨ã€‚</li>
</ul>
</li>
<li><p>åˆå§‹åŒ–ï¼šå³è°ƒç”¨<clinit>å‡½æ•°ï¼Œå¯¹é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</p>
</li>
</ol>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131057328.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image" title="">
                </div>
                <div class="image-caption">image</div>
            </figure>
<h5 id="ç¼–å†™ä»£ç æµ‹è¯•Android-ClassLoaderçš„ç»§æ‰¿å…³ç³»"><a href="#ç¼–å†™ä»£ç æµ‹è¯•Android-ClassLoaderçš„ç»§æ‰¿å…³ç³»" class="headerlink" title="ç¼–å†™ä»£ç æµ‹è¯•Android ClassLoaderçš„ç»§æ‰¿å…³ç³»"></a>ç¼–å†™ä»£ç æµ‹è¯•Android ClassLoaderçš„ç»§æ‰¿å…³ç³»</h5><p>åŠ¨æ‰‹ä¹‹å‰å…ˆé€šè¿‡<a target="_blank" rel="noopener" href="http://androidxref.com">Androidæºç é˜…è¯»ç½‘ç«™</a>ï¼Œçœ‹ä¸‹ClassLoaderçš„æºç ï¼š</p>
<p><img src="https://img.heshipeng.com/202201131124371.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="android ClassLoaderç±»æºç "></p>
<p>æ‰“å¼€AndroidXRefï¼ŒDefinitionå¡«å†™<code>ClassLoader</code>ï¼Œæœç´¢åŒ…ä½ç½®<code>libcore</code>ï¼Œå¦‚æœä¸ç¡®å®šä½ç½®ï¼Œå¯ä»¥é€‰ä¸­å…¨éƒ¨ï¼Œåªä¸è¿‡æœç´¢å‡ºæ¥çš„ç»“æœä¸æ¯”è¾ƒå¤šï¼Œç­›é€‰èµ·æ¥éº»çƒ¦ä¸€äº›ã€‚æœç´¢å‡ºæ¥ä¸€ä¸ªClassLoader.javaæ–‡ä»¶ï¼Œç‚¹å‡»è¿›å…¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">    <span class="comment">// çœç•¥</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// The parent class loader for delegation</span></span><br><span class="line">    <span class="comment">// Note: VM hardcoded the offset of this field, thus all new fields</span></span><br><span class="line">    <span class="comment">// must be added *after* it.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClassLoader parent;</span><br><span class="line">  </span><br><span class="line">  	<span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ClassLoader <span class="title">getParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çœç•¥ </span></span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…³æ³¨ä¸€ä¸ªå±æ€§å’Œä¸€ä¸ªæˆå‘˜æ–¹æ³•ï¼Œé€šè¿‡ç»„åˆå…³ç³»parentæ¥æ ‡è¯†æ¯ä¸€ä¸ªClassLoaderçš„çˆ¶äº²ï¼Œè¿™ä¸ªparentæ˜¯å®ç°åŒäº²å§”æ´¾çš„å…³é”®ï¼Œè°ƒç”¨getParentæˆå‘˜æ–¹æ³•åˆ™å¯ä»¥è·å–åˆ°parentå±æ€§ã€‚</p>
<p>çœ‹äº†è¿™ä¹ˆå¤šç†è®ºï¼Œæ²¡æœ‰åŠ¨æ‰‹codingå»å®è·µï¼Œæœ‰ä¸€ç‚¹æ¯ç‡¥ï¼Œæ¥ä¸‹æ¥ç¼–å†™ä¸€ä¸ªdemoå»æµ‹è¯•ä¸€ä¸‹Androidçš„ClassLoaderä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚</p>
<p>æ–°å»ºä¸€ä¸ªé¡¹ç›®ClassLoaderTestï¼Œç„¶åç¼–ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.classloadertest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        testClassLoader();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testClassLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰çš„ClassLoader</span></span><br><span class="line">        Context context = getApplicationContext();</span><br><span class="line">        ClassLoader thisClassLoader = context.getClassLoader();</span><br><span class="line">        <span class="comment">// æˆ–è€…ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ï¼š</span></span><br><span class="line">        <span class="comment">// ClassLoader thisClassLoader = MainActivity.class.getClassLoader();</span></span><br><span class="line">        Log.i(<span class="string">&quot;kanxue&quot;</span>, <span class="string">&quot;thisClassLoader:&quot;</span> + thisClassLoader);</span><br><span class="line">        ClassLoader tmpClassLoader = <span class="keyword">null</span>;</span><br><span class="line">        ClassLoader parentClassLoader = thisClassLoader.getParent();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘ä¸Šéå†classLoader</span></span><br><span class="line">        <span class="keyword">while</span> (parentClassLoader != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Log.i(<span class="string">&quot;kanxue&quot;</span>, <span class="string">&quot;this:&quot;</span> + thisClassLoader + <span class="string">&quot;, parent:&quot;</span> + parentClassLoader);</span><br><span class="line">            tmpClassLoader = parentClassLoader.getParent();</span><br><span class="line">            thisClassLoader = parentClassLoader;</span><br><span class="line">            parentClassLoader = tmpClassLoader;</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">&quot;kanxue&quot;</span>, <span class="string">&quot;root:&quot;</span> + thisClassLoader);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç›´æ¥ç”¨äº†ä¸Šé¢æºç åˆ†æçš„getParentæ–¹æ³•ï¼Œé€šè¿‡getParentæ–¹æ³•æ‹¿åˆ°parentï¼Œç„¶åä¸€å±‚å±‚çš„å‘ä¸Šéå†ï¼Œä»è€Œæµ‹è¯•å‡ºå„ä¸ªClassLoaderçš„ç»§æ‰¿å…³ç³»ã€‚</p>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131142562.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image" title="">
                </div>
                <div class="image-caption">image</div>
            </figure>
<h4 id="åŒäº²å§”æ´¾"><a href="#åŒäº²å§”æ´¾" class="headerlink" title="åŒäº²å§”æ´¾"></a>åŒäº²å§”æ´¾</h4><h5 id="åŒäº²å§”æ´¾çš„å·¥ä½œåŸç†"><a href="#åŒäº²å§”æ´¾çš„å·¥ä½œåŸç†" class="headerlink" title="åŒäº²å§”æ´¾çš„å·¥ä½œåŸç†"></a>åŒäº²å§”æ´¾çš„å·¥ä½œåŸç†</h5><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³æ¯ä¸ªå„¿å­éƒ½ä¸æ„¿æ„å¹²æ´»ï¼Œæ¯æ¬¡æœ‰æ´»å°±ä¸¢ç»™çˆ¶äº²å»å¹²ï¼Œç›´åˆ°çˆ¶äº²è¯´è¿™ä»¶äº‹ä¹Ÿå¹²ä¸äº†æ—¶ï¼Œå„¿å­è‡ªå·±æƒ³åŠæ³•å»å®Œæˆï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾ã€‚</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131058935.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image" title="">
                </div>
                <div class="image-caption">image</div>
            </figure>
<h5 id="ä¸ºä»€ä¹ˆä¼šæœ‰åŒäº²å§”æ´¾"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰åŒäº²å§”æ´¾" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰åŒäº²å§”æ´¾"></a>ä¸ºä»€ä¹ˆä¼šæœ‰åŒäº²å§”æ´¾</h5><ol>
<li>é¿å…é‡å¤åŠ è½½ï¼Œå¦‚æœå·²ç»åŠ è½½è¿‡ä¸€æ¬¡Classï¼Œå¯ä»¥ç›´æ¥è¯»å–å·²ç»åŠ è½½çš„Class</li>
<li>æ›´åŠ å®Œå…¨ï¼Œæ— æ³•è‡ªå®šä¹‰ç±»æ¥ä»£æ›¿ç³»ç»Ÿçš„ç±»ï¼Œå¯ä»¥é˜²æ­¢æ ¸å¿ƒAPIåº“è¢«éšæ„ç¯¡æ”¹ã€‚</li>
</ol>
<h3 id="è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜"><a href="#è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜" class="headerlink" title="è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜"></a>è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜</h3><p>é€šè¿‡å‰é¢çš„ç†è®ºçŸ¥è¯†ï¼Œæˆ‘ä»¬çŸ¥é“äº†DexClassLoaderå¯ä»¥åŠ è½½ä»»æ„ç›®å½•ä¸‹çš„dex/jar/apk/zipæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>ç”Ÿæˆä¸€ä¸ªç”¨æ¥æµ‹è¯•çš„dexæ–‡ä»¶ã€‚</li>
</ol>
<p>åˆ›å»ºé¡¹ç›®<code>DexLoaderTest</code>ï¼Œç„¶åæ–°å»ºClassï¼š<code>TestCLass</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dexloadertest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">&quot;kanxue&quot;</span>, <span class="string">&quot;call from DexLoaderTest.TestClass.testFunc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯ç®€å•çš„æ‰“å°äº†ä¸€æ¡æ—¥å¿—ã€‚</p>
<p>æ¥ç€ï¼Œæ‰“åŒ…è¯¥é¡¹ç›®ï¼Œå°†ç”Ÿæˆçš„apkè§£å‹ï¼Œå¾—åˆ°dexæ–‡ä»¶(å¦‚æœè§£å‹å¾—åˆ°å¤šä¸ªclasses.dexæ–‡ä»¶ï¼ŒæŸ¥çœ‹ä¸‹æˆ‘ä»¬ç¼–å†™çš„TestClassç±»åœ¨å“ªä¸ªclasses.dexæ–‡ä»¶)ï¼Œç„¶åå°†è¿™ä¸ªclasses.dexæ”¾åˆ°æ‰‹æœºçš„å†…å­˜å¡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push classes.dex /sdcard/</span><br></pre></td></tr></table></figure>
<ol>
<li>åŠ è½½sdcardä¸Šçš„dex</li>
</ol>
<p>ä¿®æ”¹<code>DexLoaderTest</code>ï¼Œä¿®æ”¹å…¶<code>MainActivity</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dexloadertest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dalvik.system.DexClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        String sdcardPath = Environment.getExternalStorageDirectory().getAbsolutePath();</span><br><span class="line">        dexClassLoaderTest(getApplicationContext(), sdcardPath + File.separator + <span class="string">&quot;classes.dex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dexClassLoaderTest</span><span class="params">(Context context, String dexFilePath)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(dexFilePath, <span class="keyword">null</span>, <span class="keyword">null</span>, MainActivity.class.getClassLoader());</span><br><span class="line">            clazz = dexClassLoader.loadClass(<span class="string">&quot;com.example.dexclass.TestClass&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Method testFuncMethod = clazz.getDeclaredMethod(<span class="string">&quot;testFunc&quot;</span>);</span><br><span class="line">                Object obj = clazz.newInstance();</span><br><span class="line">                testFuncMethod.invoke(obj);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException | InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç ä¹Ÿä¸å¤æ‚ï¼Œé¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ªDexClassLoaderå¯¹è±¡ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå¯¹è±¡åŠ è½½TestClassç±»ï¼Œç„¶åæ‹¿åˆ°testFuncæ–¹æ³•ï¼Œæœ€åé€šè¿‡åå°„è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è¿™é‡Œä¸»è¦å…³æ³¨çš„æ˜¯DexClassLoaderè¿™ä¸ªç±»ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DexClassLoader</span> <span class="keyword">extends</span> <span class="title">BaseDexClassLoader</span> </span>&#123;</span><br><span class="line"><span class="number">36</span>    <span class="comment">/**</span></span><br><span class="line"><span class="comment">37     * Creates a &#123;<span class="doctag">@code</span> DexClassLoader&#125; that finds interpreted and native</span></span><br><span class="line"><span class="comment">38     * code.  Interpreted classes are found in a set of DEX files contained</span></span><br><span class="line"><span class="comment">39     * in Jar or APK files.</span></span><br><span class="line"><span class="comment">40     *</span></span><br><span class="line"><span class="comment">41     * &lt;p&gt;The path lists are separated using the character specified by the</span></span><br><span class="line"><span class="comment">42     * &#123;<span class="doctag">@code</span> path.separator&#125; system property, which defaults to &#123;<span class="doctag">@code</span> :&#125;.</span></span><br><span class="line"><span class="comment">43     *</span></span><br><span class="line"><span class="comment">44     * <span class="doctag">@param</span> dexPath the list of jar/apk files containing classes and</span></span><br><span class="line"><span class="comment">45     *     resources, delimited by &#123;<span class="doctag">@code</span> File.pathSeparator&#125;, which</span></span><br><span class="line"><span class="comment">46     *     defaults to &#123;<span class="doctag">@code</span> &quot;:&quot;&#125; on Android</span></span><br><span class="line"><span class="comment">47     * <span class="doctag">@param</span> optimizedDirectory this parameter is deprecated and has no effect since API level 26.</span></span><br><span class="line"><span class="comment">48     * <span class="doctag">@param</span> librarySearchPath the list of directories containing native</span></span><br><span class="line"><span class="comment">49     *     libraries, delimited by &#123;<span class="doctag">@code</span> File.pathSeparator&#125;; may be</span></span><br><span class="line"><span class="comment">50     *     &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">51     * <span class="doctag">@param</span> parent the parent class loader</span></span><br><span class="line"><span class="comment">52     */</span></span><br><span class="line"><span class="number">53</span>    <span class="function"><span class="keyword">public</span> <span class="title">DexClassLoader</span><span class="params">(String dexPath, String optimizedDirectory,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">54</span>            String librarySearchPath, ClassLoader parent)</span> </span>&#123;</span><br><span class="line"><span class="number">55</span>        <span class="keyword">super</span>(dexPath, <span class="keyword">null</span>, librarySearchPath, parent);</span><br><span class="line"><span class="number">56</span>    &#125;</span><br><span class="line"><span class="number">57</span>&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶æ„é€ å‡½æ•°éœ€è¦å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åŒ…å«èµ„æºæ–‡ä»¶çš„jar/apk/dexç­‰æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚æœæœ‰å¤šä¸ªè·¯å¾„ï¼Œé€šè¿‡:åˆ†éš”ã€‚ç¬¬äºŒä¸ªå‚æ•°å·²ç»åºŸå¼ƒã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºnativeåº“çš„è·¯å¾„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿæ˜¯ç½®ä¸ºnullã€‚æœ€åä¸€ä¸ªæ˜¯parentç±»åŠ è½½å™¨ï¼Œæˆ‘ä»¬è®¾ç½®ä¸ºå½“å‰ç±»åŠ è½½å™¨å³å¯ã€‚</p>
<p>å› ä¸ºç”¨åˆ°å¯¹sdcardçš„è¯»å†™ï¼Œæ‰€ä»¥éœ€è¦åœ¨AndroidManifest.xmlä¸­æ·»åŠ ç›¸åº”çš„æƒé™ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> <span class="attr">android:maxSdkVersion</span>=<span class="string">&quot;28&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç¨‹åºï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131409909.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image" title="">
                </div>
                <div class="image-caption">image</div>
            </figure>
<h3 id="è§£å†³ç¬¬äºŒä¸ªé—®é¢˜"><a href="#è§£å†³ç¬¬äºŒä¸ªé—®é¢˜" class="headerlink" title="è§£å†³ç¬¬äºŒä¸ªé—®é¢˜"></a>è§£å†³ç¬¬äºŒä¸ªé—®é¢˜</h3><p>å¦‚æœä¸è€ƒè™‘åŒäº²å§”æ´¾ä»¥åŠActivityç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ç”¨ç±»ä¼¼äºç¬¬ä¸€ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œé‡‡ç”¨DexClassLoaderåŠ è½½Activityç±»ï¼Œç„¶åä½¿ç”¨Intentç›´æ¥è®¿é—®è¿™ä¸ªActivityå‘¢ï¼Ÿè¯´å¹²å°±å¹²ã€‚</p>
<ol>
<li>ç”Ÿæˆä¸€ä¸ªç”¨æ¥æµ‹è¯•çš„dex</li>
</ol>
<p>æ–°å»ºä¸€ä¸ªTestActivityæ–‡ä»¶ï¼Œç„¶åè®©TestActivityç»§æ‰¿AppCompatActivtyï¼Œå¹¶é‡å†™onCreateæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        Log.d(<span class="string">&quot;TestActivity&quot;</span>, <span class="string">&quot;i am from TestActivity.onCreate&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œä»…ä»…æ˜¯æ‰“å°ä¸€æ¡æ—¥å¿—ã€‚</p>
<p>åŒæ ·åœ°ï¼Œæ‰“åŒ…è¯¥é¡¹ç›®ï¼Œå°†ç”Ÿæˆçš„apkè§£å‹ï¼Œå¾—åˆ°dexæ–‡ä»¶ï¼Œç„¶åå°†è¿™ä¸ªclasses.dexæ”¾åˆ°æ‰‹æœºçš„å†…å­˜å¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push classes3.dex /sdcard/</span><br></pre></td></tr></table></figure>
<ol>
<li>åŠ è½½å¹¶å¯åŠ¨Activity</li>
</ol>
<p>ç¼–è¾‘DexClassLoaderï¼Œä¿®æ”¹MainActivityä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        String sdcardPath = Environment.getExternalStorageDirectory().getAbsolutePath();</span><br><span class="line">        startActivityTest(<span class="keyword">this</span>, sdcardPath + File.separator + <span class="string">&quot;classes3.dex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityTest</span><span class="params">(Context context, String dexFilePath)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = <span class="keyword">null</span>;</span><br><span class="line">        DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(dexFilePath, <span class="keyword">null</span>, <span class="keyword">null</span>, MainActivity.class.getClassLoader());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            clazz = dexClassLoader.loadClass(<span class="string">&quot;com.example.dexclass.TestActivity&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        context.startActivity(<span class="keyword">new</span> Intent(context, clazz));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæœ‰ç”¨åˆ°<code>TestActivity</code>ï¼Œæ‰€ä»¥éœ€è¦åœ¨AndroidManifest.xmlä¸­å£°æ˜ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.dexclass.TestActivity&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œé¡¹ç›®ï¼Œåœ¨æ‰‹æœºè®¾ç½®ä¸­ç»™åº”ç”¨å¼€å¯sdcardè¯»å†™æƒé™ï¼Œç„¶åé‡æ–°æ‰§è¡Œï¼Œç»“æœæŠ¥é”™ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131612910.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="æ‰§è¡Œç»“æœ" title="">
                </div>
                <div class="image-caption">æ‰§è¡Œç»“æœ</div>
            </figure>
<p>æƒ³æƒ³ä¹Ÿä¸å¯èƒ½æˆåŠŸï¼Œè¦æ˜¯èƒ½è·Ÿé—®é¢˜ä¸€ä¸€æ ·è§£å†³ï¼Œé‚£è¿˜å«ä¸¤ä¸ªé—®é¢˜å—ğŸ¤ª</p>
<p>é‚£è¯¥å¦‚ä½•è§£å†³ç¬¬äºŒä¸ªé—®é¢˜å‘¢ï¼Ÿæ­¤æ—¶å°±å¾—ä»Activityçš„å¯åŠ¨æµç¨‹è¯´èµ·äº†ï¼Œä½†æ˜¯è¿™ç¯‡æ–‡ç« çš„ç›®çš„è¿˜æ˜¯ä»¥åŠ¨æ€åŠ è½½ä¸ºä¸»ï¼ŒActivityä»¥åŠAppçš„å¯åŠ¨æµç¨‹ä¼šæœ‰ä¸“é—¨çš„æ–‡ç« å»ä»‹ç»ï¼Œæœ¬æ–‡æœ€åç»™å‡ºçš„å‚è€ƒé“¾æ¥ï¼Œä¹Ÿä¼šæœ‰åŒ…å«Activityå¯åŠ¨æµç¨‹çš„ä»‹ç»ã€‚è¿™é‡ŒæŒ‘å‡ ä¸ªå…³é”®é“¾è·¯ä¸Šçš„å‡½æ•°ç®€å•è¯´ä¸‹åŸç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  Core implementation of activity launch. */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Activity <span class="title">performLaunchActivity</span><span class="params">(ActivityClientRecord r, Intent customIntent)</span> </span>&#123;</span><br><span class="line">    ActivityInfo aInfo = r.activityInfo;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (r.packageInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">        r.packageInfo = getPackageInfo(aInfo.applicationInfo, r.compatInfo,</span><br><span class="line">                Context.CONTEXT_INCLUDE_CODE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">    Activity activity = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        </span><br><span class="line">        java.lang.ClassLoader cl = appContext.getClassLoader();</span><br><span class="line">        activity = mInstrumentation.newActivity(</span><br><span class="line">                cl, component.getClassName(), r.intent);</span><br><span class="line">        StrictMode.incrementExpectedActivityCount(activity.getClass());</span><br><span class="line">        r.intent.setExtrasClassLoader(cl);</span><br><span class="line">        r.intent.prepareToEnterProcess();</span><br><span class="line">        <span class="keyword">if</span> (r.state != <span class="keyword">null</span>) &#123;</span><br><span class="line">            r.state.setClassLoader(cl);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mInstrumentation.onException(activity, e)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                <span class="string">&quot;Unable to instantiate activity &quot;</span> + component</span><br><span class="line">                + <span class="string">&quot;: &quot;</span> + e.toString(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> activity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹æ³¨é‡Šå°±çŸ¥é“ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¯åŠ¨Activityçš„æ ¸å¿ƒæ–¹æ³•ï¼Œåœ¨å¯åŠ¨Activityä¹‹å‰ä¼šé€šè¿‡è°ƒç”¨<code>getPackageInfo</code>æ–¹æ³•æ¥å…ˆè·å–å¹¶è§£æActivityä¿¡æ¯ï¼Œæˆ‘ä»¬è¿›åˆ°è¿™ä¸ªæ–¹æ³•ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> LoadedApk <span class="title">getPackageInfo</span><span class="params">(ApplicationInfo ai, CompatibilityInfo compatInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="keyword">int</span> flags)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> getPackageInfo(ai, compatInfo, <span class="keyword">null</span>, securityViolation, includeCode,</span><br><span class="line">                        registerPackage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  è¿™ä¸ªä¸‰ä¸ªå‚æ•°çš„<code>getPackageInfo</code>è°ƒç”¨äº†äº”ä¸ªå‚æ•°çš„<code>getPackageInfo</code>æ–¹æ³•ï¼Œæ³¨æ„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ çš„æ˜¯<code>null</code>ï¼Œæˆ‘ä»¬ç»§ç»­è¿›å…¥äº”ä¸ªå‚æ•°çš„<code>getPackageInfo</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> LoadedApk <span class="title">getPackageInfo</span><span class="params">(ApplicationInfo aInfo, CompatibilityInfo compatInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">        ClassLoader baseLoader, <span class="keyword">boolean</span> securityViolation, <span class="keyword">boolean</span> includeCode,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">boolean</span> registerPackage)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> differentUser = (UserHandle.myUserId() != UserHandle.getUserId(aInfo.uid));</span><br><span class="line">    <span class="keyword">synchronized</span> (mResourcesManager) &#123;</span><br><span class="line">        WeakReference&lt;LoadedApk&gt; ref;</span><br><span class="line">        <span class="keyword">if</span> (differentUser) &#123;</span><br><span class="line">            <span class="comment">// Caching not supported across users</span></span><br><span class="line">            ref = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (includeCode) &#123;</span><br><span class="line">            ref = mPackages.get(aInfo.packageName);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ref = mResourcePackages.get(aInfo.packageName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LoadedApk packageInfo = ref != <span class="keyword">null</span> ? ref.get() : <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (packageInfo == <span class="keyword">null</span> || (packageInfo.mResources != <span class="keyword">null</span></span><br><span class="line">                &amp;&amp; !packageInfo.mResources.getAssets().isUpToDate())) &#123;</span><br><span class="line">            <span class="keyword">if</span> (localLOGV) Slog.v(TAG, (includeCode ? <span class="string">&quot;Loading code package &quot;</span></span><br><span class="line">                    : <span class="string">&quot;Loading resource-only package &quot;</span>) + aInfo.packageName</span><br><span class="line">                    + <span class="string">&quot; (in &quot;</span> + (mBoundApplication != <span class="keyword">null</span></span><br><span class="line">                            ? mBoundApplication.processName : <span class="keyword">null</span>)</span><br><span class="line">                    + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            packageInfo =</span><br><span class="line">                <span class="keyword">new</span> LoadedApk(<span class="keyword">this</span>, aInfo, compatInfo, baseLoader,</span><br><span class="line">                        securityViolation, includeCode &amp;&amp;</span><br><span class="line">                        (aInfo.flags&amp;ApplicationInfo.FLAG_HAS_CODE) != <span class="number">0</span>, registerPackage);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (mSystemThread &amp;&amp; <span class="string">&quot;android&quot;</span>.equals(aInfo.packageName)) &#123;</span><br><span class="line">                packageInfo.installSystemApplicationInfo(aInfo,</span><br><span class="line">                        getSystemContext().mPackageInfo.getClassLoader());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> packageInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸€ä¸ªHashMapå³mPackagesç»´æŠ¤åŒ…åå’ŒLoadedApkçš„å¯¹åº”å…³ç³»ï¼Œå³æ¯ä¸€ä¸ªåº”ç”¨æœ‰ä¸€ä¸ªé”®å€¼å¯¹å¯¹åº”ï¼Œå¦‚æœä¸ºnullï¼Œå°±æ–°åˆ›å»ºä¸€ä¸ªLoadedApkå¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°Mapä¸­ã€‚ç¬¬ä¸€æ¬¡æ‰§è¡ŒActivityçš„æ—¶å€™ï¼Œå¾ˆæ˜¾ç„¶æ˜¯æ²¡æœ‰è¿™ä¸ªLoadedApkå¯¹è±¡çš„ï¼Œæ‰€ä»¥ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„LoadedApkå¯¹è±¡ï¼Œç„¶åæ³¨æ„åˆ°ä¼ å…¥äº†ä¸€ä¸ªbaseLoaderï¼Œæ­£æ˜¯ä¸Šé¢ä¼ çš„<code>null</code>ã€‚</p>
<p>æˆ‘ä»¬å†å›å¤´çœ‹ä¸‹<code>performLaunchActivity</code>ï¼Œå½“è°ƒç”¨å®Œ<code>getPackageInfo</code>ä¹‹åï¼Œä¼šè°ƒç”¨<code>java.lang.ClassLoader cl = appContext.getClassLoader();</code>å»è·å–<code>classLoader</code>ï¼Œæˆ‘ä»¬è¿›åˆ°<code>ContextImpl.getClassLoader</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClassLoader <span class="title">getClassLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mClassLoader != <span class="keyword">null</span> ? mClassLoader : (mPackageInfo != <span class="keyword">null</span> ? mPackageInfo.getClassLoader() : ClassLoader.getSystemClassLoader());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>mClassLoader</code>æ­£æ˜¯ä¸Šé¢ä¼ å…¥çš„<code>null</code>ï¼Œè€Œ<code>mPackageInfo</code>æ˜¯ä¸Šè¾¹ç”Ÿæˆçš„<code>LoadedApk</code>å¯¹è±¡ä¸ä¸ºç©ºï¼Œæ‰€ä»¥ä¼šè°ƒç”¨<code>LoadedApk</code>çš„<code>getClassLoader</code>æ–¹æ³•ã€‚è¿™é‡Œå°±ä¸åœ¨ä¸€å±‚ä¸€å±‚çš„å‰¥å¼€äº†ï¼Œå› ä¸ºæƒ³èŠ‚çœç‚¹ç¬”è¿¹ğŸ¤ªï¼Œæ€»ä¹‹ï¼Œç¿»æºç åˆ°æœ€åï¼Œä½ ä¼šå‘ç°æœ€ç»ˆæ˜¯é€šè¿‡è°ƒç”¨<code>ClassLoader.getSystemClassLoader</code>æ¥è·å–ä¸€ä¸ª<code>classLoader</code>ï¼Œè€Œè¿™ä¸ª<code>classLoader</code>æ­£å¥½æ˜¯<code>PathClassLoader</code>ã€‚</p>
<p>åˆ°è¿™é‡Œä¸€åˆ‡çœŸç›¸å¤§ç™½äº†å§ï¼Ÿå‰é¢<strong>æˆ‘ä»¬è™½ç„¶ç”¨<code>DexClassLoader</code>é€šè¿‡å¯¹APKçš„åŠ¨æ€åŠ è½½æˆåŠŸåŠ è½½äº†<code>TestActivity</code>åˆ°è™šæ‹Ÿæœºï¼Œä½†æ˜¯å½“ç³»ç»Ÿå¯åŠ¨è¯¥<code>Activity</code>çš„æ—¶å€™ï¼Œä¾ç„¶ä¼šå‡ºç°åŠ è½½ç±»å¤±è´¥çš„å¼‚å¸¸ï¼Œå› ä¸º<code>Activity</code>åœ¨å¯åŠ¨æ—¶ç”¨åˆ°çš„æ˜¯<code>PathClassLoader</code></strong>ã€‚å‰é¢åœ¨ä»‹ç»<code>Android</code>çš„<code>ClassLoader</code>çš„æ—¶å€™æåˆ°è¿‡ï¼Œ<code>PathClassLoader</code>æ˜¯<code>Android</code>é»˜è®¤ä½¿ç”¨çš„ç±»åŠ è½½å™¨ï¼Œä¸€ä¸ª<code>APK</code>ä¸­çš„<code>Activity</code>ç­‰ç±»ä¾¿æ˜¯åœ¨å…¶ä¸­åŠ è½½ï¼Œä½†æ˜¯æˆ‘ä»¬çš„<code>TestActivity</code>ä¸å­˜åœ¨äºå½“å‰çš„<code>APK</code>ï¼Œè€Œæ˜¯åœ¨å¤–éƒ¨çš„<code>dex</code>æ–‡ä»¶ä¸Šï¼Œè‡ªç„¶è€Œç„¶çš„å°±ä¼šå‡ºç°ä¸Šè¾¹æ‰¾ä¸åˆ°<code>Activity</code>çš„å¼‚å¸¸äº†ã€‚</p>
<p>é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ›¿æ¢æ‰è¿™ä¸ª<code>PathClassLoader</code>ä¸º<code>DexClassLoader</code>ä¸å°±å¥½äº†å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚é™¤äº†è¿™ä¸ªæ–¹æ¡ˆä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨åŒäº²å§”æ´¾çš„åŸç†ï¼Œç»™å‡ºå¦ä¸€ç§æ–¹æ¡ˆã€‚ä¸¤ç§è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>
<ul>
<li>æ›¿æ¢ç³»ç»Ÿç»„ä»¶ç±»åŠ è½½å™¨ä¸ºæˆ‘ä»¬çš„<code>DexClassLoader</code>ï¼ŒåŒæ—¶è®¾ç½®<code>DexClassLoader</code>çš„<code>parent</code>ä¸ºç³»ç»Ÿç»„ä»¶çš„ç±»åŠ è½½å™¨ã€‚</li>
<li>æ‰“ç ´åŸæœ‰çš„åŒäº²å…³ç³»ï¼Œåœ¨ç³»ç»Ÿç»„ä»¶ç±»åŠ è½½å™¨å’Œ<code>BootClassLoader</code>ä¸­æ’å…¥æˆ‘ä»¬è‡ªå·±çš„<code>DexClassLoader</code>å³å¯ã€‚</li>
</ul>
<h4 id="æ–¹æ¡ˆä¸€ï¼šæ›¿æ¢mClassLoaderä¸ºDexClassLoader"><a href="#æ–¹æ¡ˆä¸€ï¼šæ›¿æ¢mClassLoaderä¸ºDexClassLoader" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šæ›¿æ¢mClassLoaderä¸ºDexClassLoader"></a>æ–¹æ¡ˆä¸€ï¼šæ›¿æ¢<code>mClassLoader</code>ä¸º<code>DexClassLoader</code></h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201152137281.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image-20220115213655318" title="">
                </div>
                <div class="image-caption">image-20220115213655318</div>
            </figure>ä¿®æ”¹`MainActivity`çš„ä»£ç å¦‚ä¸‹ï¼š

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        String sdcardPath = Environment.getExternalStorageDirectory().getAbsolutePath();</span><br><span class="line">        startActivityTest(<span class="keyword">this</span>, sdcardPath + File.separator + <span class="string">&quot;classes3.dex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">replaceClassLoader</span><span class="params">(ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åŠ è½½ActivityThreadç±»</span></span><br><span class="line">            Class&lt;?&gt; ActivityThreadClazz = classLoader.loadClass(<span class="string">&quot;android.app.ActivityThread&quot;</span>);</span><br><span class="line">            <span class="comment">// è·å–currentActivityThreadæ–¹æ³•,ä»è€Œè·å–ActivityThreadå®ä¾‹</span></span><br><span class="line">            Method currentActivityThreadMethod = ActivityThreadClazz.getDeclaredMethod(<span class="string">&quot;currentActivityThread&quot;</span>);</span><br><span class="line">            currentActivityThreadMethod.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            Object activityThreadObj = currentActivityThreadMethod.invoke(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–ActivityThreadçš„mPackageå±æ€§</span></span><br><span class="line">            Field mPackageField = ActivityThreadClazz.getDeclaredField(<span class="string">&quot;mPackages&quot;</span>);</span><br><span class="line">            mPackageField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// è·å–loadedApkå¯¹è±¡</span></span><br><span class="line">            ArrayMap mPackageObj = (ArrayMap) mPackageField.get(activityThreadObj);</span><br><span class="line">            WeakReference wr = (WeakReference) mPackageObj.get(<span class="keyword">this</span>.getPackageName());</span><br><span class="line">            Object loadedApkObj = wr.get();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ›¿æ¢mClassLoader</span></span><br><span class="line">            Class loadedApkClazz = classLoader.loadClass(<span class="string">&quot;android.app.LoadedApk&quot;</span>);</span><br><span class="line">            Field mClassLoader = loadedApkClazz.getDeclaredField(<span class="string">&quot;mClassLoader&quot;</span>);</span><br><span class="line">            mClassLoader.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            mClassLoader.set(loadedApkObj, classLoader);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityTest</span><span class="params">(Context context, String dexFilePath)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = <span class="keyword">null</span>;</span><br><span class="line">        DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(dexFilePath, <span class="keyword">null</span>, <span class="keyword">null</span>, MainActivity.class.getClassLoader());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            replaceClassLoader(dexClassLoader);</span><br><span class="line">            clazz = dexClassLoader.loadClass(<span class="string">&quot;com.example.dexclass.TestActivity&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        context.startActivity(<span class="keyword">new</span> Intent(context, clazz));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œé¡¹ç›®ï¼Œç»“æœå¦‚é¢„æœŸï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201152139770.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image-20220115213932649" title="">
                </div>
                <div class="image-caption">image-20220115213932649</div>
            </figure>
<h4 id="æ–¹æ¡ˆäºŒï¼šåœ¨mClassLoaderå’ŒBootClassLoaderä¹‹é—´æ’å…¥DexClassLoader"><a href="#æ–¹æ¡ˆäºŒï¼šåœ¨mClassLoaderå’ŒBootClassLoaderä¹‹é—´æ’å…¥DexClassLoader" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šåœ¨mClassLoaderå’ŒBootClassLoaderä¹‹é—´æ’å…¥DexClassLoader"></a>æ–¹æ¡ˆäºŒï¼šåœ¨<code>mClassLoader</code>å’Œ<code>BootClassLoader</code>ä¹‹é—´æ’å…¥<code>DexClassLoader</code></h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201152147745.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image-20220115214708638" title="">
                </div>
                <div class="image-caption">image-20220115214708638</div>
            </figure>
<p>ä¿®æ”¹<code>TestActivity</code>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        Log.d(<span class="string">&quot;TestActivity&quot;</span>, <span class="string">&quot;i am from TestActivity.onCreate&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠ<code>AppCompatActivity</code>æ”¹ä¸ºäº†<code>Activity</code>ï¼Œé˜²æ­¢æœ‰ä¸€äº›ç±»é‡å¤åŠ è½½ã€‚</p>
<p>å†æ¬¡ä¿®æ”¹<code>MainActivity</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        String sdcardPath = Environment.getExternalStorageDirectory().getAbsolutePath();</span><br><span class="line">        startActivityTest(<span class="keyword">this</span>, sdcardPath + File.separator + <span class="string">&quot;classes3.dex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityTest</span><span class="params">(Context context, String dexFilePath)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = <span class="keyword">null</span>;</span><br><span class="line">        ClassLoader pathClassLoader = MainActivity.class.getClassLoader();</span><br><span class="line">        ClassLoader bootClassLoader = MainActivity.class.getClassLoader().getParent();</span><br><span class="line">        <span class="comment">// dexClassLoaderçš„parentä¸ºBootClassLoader</span></span><br><span class="line">        DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(dexFilePath, <span class="keyword">null</span>, <span class="keyword">null</span>, bootClassLoader);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field parentField = ClassLoader.class.getDeclaredField(<span class="string">&quot;parent&quot;</span>);</span><br><span class="line">            parentField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// å½“å‰ç»„ä»¶çš„ClassLoaderçš„parentä¸ºDexClassLoader</span></span><br><span class="line">            parentField.set(pathClassLoader, dexClassLoader);</span><br><span class="line">            clazz = dexClassLoader.loadClass(<span class="string">&quot;com.example.dexclass.TestActivity&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        context.startActivity(<span class="keyword">new</span> Intent(context, clazz));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œé¡¹ç›®ï¼Œç»“æœä¹Ÿå¦‚é¢„æœŸï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201152315708.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image-20220115231522507" title="">
                </div>
                <div class="image-caption">image-20220115231522507</div>
            </figure>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åŠ¨æ€åŠ è½½å°±æ˜¯ç”¨åˆ°çš„æ—¶å€™å†å»åŠ è½½ï¼Œä¹Ÿå«æ‡’åŠ è½½ï¼Œä¹Ÿå°±æ„å‘³ç€ç”¨ä¸åˆ°çš„æ—¶å€™æ˜¯ä¸ä¼šå»åŠ è½½çš„ã€‚åŠ¨æ€åŠ è½½æ˜¯dexåŠ å£³ï¼Œæ’ä»¶åŒ–ï¼Œçƒ­æ›´æ–°çš„åŸºç¡€ã€‚åŠ¨æ€åŠ è½½çš„dexä¸å…·æœ‰ç”Ÿå‘½å‘¨æœŸç‰¹å¾ï¼ŒAppä¸­çš„Activity, Serviceç­‰ç»„ä»¶æ— æ³•æ­£å¸¸å·¥ä½œï¼Œåªèƒ½å®Œæˆä¸€èˆ¬å‡½æ•°çš„è°ƒç”¨ï¼›éœ€è¦å¯¹ClassLoaderè¿›è¡Œä¿®æ­£ï¼ŒAppæ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œä¸¤ç§ä¿®æ­£æ–¹æ¡ˆï¼š</p>
<ol>
<li>æ›¿æ¢ç³»ç»Ÿç»„ä»¶ç±»åŠ è½½å™¨ä¸ºæˆ‘ä»¬çš„<code>DexClassLoader</code>ï¼ŒåŒæ—¶è®¾ç½®<code>DexClassLoader</code>çš„<code>parent</code>ä¸ºç³»ç»Ÿç»„ä»¶çš„ç±»åŠ è½½å™¨ã€‚</li>
<li>æ‰“ç ´åŸæœ‰çš„åŒäº²å…³ç³»ï¼Œåœ¨ç³»ç»Ÿç»„ä»¶ç±»åŠ è½½å™¨å’Œ<code>BootClassLoader</code>ä¸­æ’å…¥æˆ‘ä»¬è‡ªå·±çš„<code>DexClassLoader</code>å³å¯ã€‚</li>
</ol>
<h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cauchyweierstrass/article/details/51087198">AndroidåŠ¨æ€åŠ è½½ActivityåŸç†</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-252630.htm#msg_header_h2_6">FARTï¼šARTç¯å¢ƒä¸‹åŸºäºä¸»åŠ¨è°ƒç”¨çš„è‡ªåŠ¨åŒ–è„±å£³æ–¹æ¡ˆ</a></p>
<p><a target="_blank" rel="noopener" href="http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/app/ActivityThread.java">ActivityThreadæºç </a></p>
<p><a target="_blank" rel="noopener" href="https://samiu.top/2020/04/16/Activity%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E6%8E%A2%E7%A9%B6/">Activityçš„å¯åŠ¨æµç¨‹æ¢ç©¶</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000004062880">AndroidåŠ¨æ€åŠ è½½åŸºç¡€ ClassLoaderå·¥ä½œæœºåˆ¶</a></p>

    

        <a href="/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/" class="post-more waves-effect waves-button">
            Continue reading...
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%80%86%E5%90%91/" rel="tag">é€†å‘</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-å¤§ç«¯è¿˜æ˜¯å°ç«¯"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2022-01-05 20:54:45" datetime="2022-01-05T12:54:45.000Z"  itemprop="datePublished">2022-01-05</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%9D%82%E8%B0%88/">è®¡ç®—æœºæ‚è°ˆ</a></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/%E5%A4%A7%E7%AB%AF%E8%BF%98%E6%98%AF%E5%B0%8F%E7%AB%AF/">å¤§ç«¯è¿˜æ˜¯å°ç«¯ï¼Ÿ</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <div align="middle"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=3560361&auto=1&height=66"></iframe></div>



<h3 id="ä»€ä¹ˆæ˜¯å¤§ç«¯-ä»€ä¹ˆæ˜¯å°ç«¯"><a href="#ä»€ä¹ˆæ˜¯å¤§ç«¯-ä»€ä¹ˆæ˜¯å°ç«¯" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤§ç«¯? ä»€ä¹ˆæ˜¯å°ç«¯?"></a>ä»€ä¹ˆæ˜¯å¤§ç«¯? ä»€ä¹ˆæ˜¯å°ç«¯?</h3><p>åœ¨ææ˜ç™½å¤§å°ç«¯ä¹‹å‰ï¼Œå…ˆçœ‹2ä¸ªæ¦‚å¿µï¼Œ<strong>é«˜ä½å­—èŠ‚</strong>å’Œ<strong>é«˜ä½åœ°å€</strong></p>
<h4 id="é«˜ä½å­—èŠ‚"><a href="#é«˜ä½å­—èŠ‚" class="headerlink" title="é«˜ä½å­—èŠ‚"></a>é«˜ä½å­—èŠ‚</h4><p><img src="https://img.heshipeng.com/202201051209394.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image-20220105120910483"></p>
<p>é«˜ä½å­—èŠ‚ç±»ä¼¼äºæ•°å­—è¡¨ç¤ºçš„ä½æ•°ï¼Œå¦‚æœæŠŠunsigned intçœ‹æˆæ˜¯åƒä½çš„è¯ï¼Œä»å·¦åˆ°å³ä¾æ¬¡åƒä½ï¼Œç™¾ä½ï¼Œåä½ï¼Œä¸ªä½ï¼Œå·¦é«˜å³ä½ã€‚</p>
<ul>
<li>å¯¹äºä¸€ä¸ªå­—èŠ‚çš„æ•°æ®(char/unsigned char/bool)è€Œè¨€ï¼Œæ²¡æœ‰é«˜ä½å­—èŠ‚ä¹‹åˆ†ã€‚</li>
<li>åªæœ‰å¤§äºä¸€ä¸ªå­—èŠ‚ä»¥ä¸Šçš„æ•°æ®æ‰è¦åŒºåˆ†é«˜ä½å­—èŠ‚ã€‚</li>
</ul>
<h4 id="é«˜ä½åœ°å€"><a href="#é«˜ä½åœ°å€" class="headerlink" title="é«˜ä½åœ°å€"></a>é«˜ä½åœ°å€</h4><p><img src="https://img.heshipeng.com/202201051355138.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image-20220105135527049"></p>
<ul>
<li>è®¡ç®—æœºçš„åŸºæœ¬å­˜å‚¨å•ä½æ˜¯å­—èŠ‚(byte)ï¼Œ1byte = 8bitï¼Œä»00000000åˆ°11111111è¡¨ç¤ºçš„èŒƒå›´æ˜¯[0,255]ã€‚</li>
<li>å¯¹äºå†…å­˜ä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚(byte)ï¼Œéƒ½æœ‰ä¸€ä¸ªç´¢å¼•ç¼–å·ï¼Œå°±æ˜¯æŒ‡é’ˆï¼Œä¹Ÿå³åœ°å€ï¼Œç´¢å¼•æ˜¯ä»0å¼€å§‹ï¼Œä»å·¦åˆ°å³ä¾æ¬¡å¢å¤§ï¼Œæ‰€ä»¥å·¦è¾¹è¢«ç§°ä¸ºä½åœ°å€ï¼Œå³è¾¹è¢«ç§°ä¸ºé«˜åœ°å€ã€‚</li>
</ul>
<h4 id="å¤§ç«¯ï¼Œå°ç«¯"><a href="#å¤§ç«¯ï¼Œå°ç«¯" class="headerlink" title="å¤§ç«¯ï¼Œå°ç«¯"></a>å¤§ç«¯ï¼Œå°ç«¯</h4><p>ç›—ç”¨ç»´åŸºç™¾ç§‘ä¸Šçš„2å¼ å›¾æ¥è§£é‡Šä¸‹å¤§å°ç«¯ã€‚</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201051401228.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="å¤§ç«¯" title="">
                </div>
                <div class="image-caption">å¤§ç«¯</div>
            </figure>
<p>æ ¹æ®å¤§ç«¯çš„å®šä¹‰ï¼šæ•°æ®çš„<strong>é«˜å­—èŠ‚</strong>ä¿å­˜åœ¨å†…å­˜çš„ä½åœ°å€ä¸­ï¼Œæ•°æ®çš„<strong>ä½å­—èŠ‚</strong>ä¿å­˜åœ¨å†…å­˜çš„é«˜åœ°å€ä¸­ã€‚</p>
<p><img src="https://img.heshipeng.com/202201051407227.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="å°ç«¯"></p>
<p>æ ¹æ®å°ç«¯çš„å®šä¹‰ï¼šæ•°æ®çš„<strong>ä½å­—èŠ‚</strong>ä¿å­˜åœ¨å†…å­˜çš„<strong>ä½åœ°å€</strong>ä¸­ï¼Œæ•°æ®çš„<strong>é«˜å­—èŠ‚</strong>ä¿å­˜åœ¨å†…å­˜çš„<strong>é«˜åœ°å€</strong>ä¸­ã€‚</p>
<p>æ¯”å¦‚åå…­è¿›åˆ¶æ•°<code>0xDC6E35FF</code>ï¼Œä»å·¦åˆ°å³ä¾æ¬¡æ˜¯é«˜å­—èŠ‚åˆ°ä½å­—èŠ‚ï¼Œå› ä¸ºä»å·¦åˆ°å³åŒæ—¶æ˜¯ç”±ä½åœ°å€åˆ°é«˜åœ°å€ï¼Œå¦‚æœæŒ‰ç…§å°ç«¯å­˜å‚¨ï¼Œåˆ™<code>0xDC6E35FF</code>åœ¨å†…å­˜ä¸­å¯¹åº”å­˜å‚¨ä¸º<code>0xFF356EDC</code>ï¼Œå¦‚æœæŒ‰ç…§å¤§ç«¯å­˜å‚¨ï¼Œåˆ™åº”è¯¥æ˜¯<code>0xDC6E35FF</code>ã€‚</p>
<h3 id="å¦‚ä½•åˆ¤æ–­å¤§ç«¯è¿˜æ˜¯å°ç«¯"><a href="#å¦‚ä½•åˆ¤æ–­å¤§ç«¯è¿˜æ˜¯å°ç«¯" class="headerlink" title="å¦‚ä½•åˆ¤æ–­å¤§ç«¯è¿˜æ˜¯å°ç«¯"></a>å¦‚ä½•åˆ¤æ–­å¤§ç«¯è¿˜æ˜¯å°ç«¯</h3><p>ç”¨<code>python</code>æŸ¥çœ‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;import sys; print(sys.byteorder)&quot;</span></span><br></pre></td></tr></table></figure>
<p>ç”¨<code>c</code>æŸ¥çœ‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0x11223344</span>;</span><br><span class="line">    <span class="keyword">char</span> *p;</span><br><span class="line"></span><br><span class="line">    p = (<span class="keyword">char</span> *) &amp;i;</span><br><span class="line">    <span class="keyword">if</span> (*p == <span class="number">0x44</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Little endian\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Big endian\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lwfcgz/article/details/50476051">åˆ¤æ–­è®¡ç®—æœºæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c41741b5c19d">è°ˆå†…å­˜</a></p>
</li>
</ul>

    

        <a href="/%E5%A4%A7%E7%AB%AF%E8%BF%98%E6%98%AF%E5%B0%8F%E7%AB%AF/" class="post-more waves-effect waves-button">
            Continue reading...
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/" rel="tag">æ•°æ®å­˜å‚¨</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-ä¸€æ–‡äº†è§£Androidæ„å»ºå·¥å…·â€”â€”AAPT2"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2022-01-01 10:54:45" datetime="2022-01-01T02:54:45.000Z"  itemprop="datePublished">2022-01-01</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3Android%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E2%80%94%E2%80%94AAPT2/">ä¸€æ–‡äº†è§£Androidæ„å»ºå·¥å…·â€”â€”AAPT2</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <p><meta name="referrer" content="no-referrer"/></p>
<div align="middle"><iframe width="560" height="315" src="https://www.youtube.com/embed/tHv9XMzEnjo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>

<h2 id="ä»€ä¹ˆæ˜¯AAPT2-Android-Asset-Packaging-Tool"><a href="#ä»€ä¹ˆæ˜¯AAPT2-Android-Asset-Packaging-Tool" class="headerlink" title="ä»€ä¹ˆæ˜¯AAPT2(Android Asset Packaging Tool)"></a>ä»€ä¹ˆæ˜¯AAPT2(Android Asset Packaging Tool)</h2><p>åœ¨Androidå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡Gradleå‘½ä»¤ï¼Œå¯åŠ¨ä¸€ä¸ªæ„å»ºä»»åŠ¡ï¼Œæœ€ç»ˆä¼šç”Ÿæˆæ„å»ºäº§ç‰©â€œAPKâ€æ–‡ä»¶ã€‚å¸¸è§„APKçš„æ„å»ºæµç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/FmSi0GYeL8d3wSapWsPae4kr28Om?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="androidæ„å»º.png" title="">
                </div>
                <div class="image-caption">androidæ„å»º.png</div>
            </figure>
<p>ï¼ˆå¼•ç”¨è‡ªGoogleå®˜æ–¹æ–‡æ¡£ï¼‰</p>
<ul>
<li>ç¼–è¯‘æ‰€æœ‰çš„èµ„æºæ–‡ä»¶ï¼Œç”Ÿæˆèµ„æºè¡¨å’ŒRæ–‡ä»¶ï¼›</li>
<li>ç¼–è¯‘Javaæ–‡ä»¶å¹¶æŠŠclassæ–‡ä»¶æ‰“åŒ…ä¸ºdexæ–‡ä»¶ï¼›</li>
<li>æ‰“åŒ…èµ„æºå’Œdexæ–‡ä»¶ï¼Œç”Ÿæˆæœªç­¾åçš„APKæ–‡ä»¶ï¼›</li>
<li>ç­¾åAPKç”Ÿæˆæ­£å¼åŒ…ã€‚</li>
</ul>
<p>è€ç‰ˆæœ¬çš„Androidé»˜è®¤ä½¿ç”¨AAPTç¼–è¯‘å™¨è¿›è¡Œèµ„æºç¼–è¯‘ï¼Œä»Android Studio 3.0å¼€å§‹ï¼ŒASé»˜è®¤å¼€å¯äº† AAPT2ä½œä¸ºèµ„æºç¼–è¯‘çš„ç¼–è¯‘å™¨ï¼Œç›®å‰çœ‹æ¥ï¼ŒAAPT2ä¹Ÿæ˜¯Androidå‘å±•çš„ä¸»æµè¶‹åŠ¿ï¼Œå­¦ä¹ AAPT2çš„å·¥ä½œåŸç†å¯ä»¥å¸®åŠ©Androidå¼€å‘æ›´å¥½çš„æŒæ¡APKæ„å»ºæµç¨‹ï¼Œä»è€Œå¸®åŠ©è§£å†³å®é™…å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜ã€‚</p>
<p>AAPT2çš„å¯æ‰§è¡Œæ–‡ä»¶éšAndroid SDKçš„Build Toolsä¸€èµ·å‘å¸ƒï¼Œåœ¨Android Studioçš„build-toolsæ–‡ä»¶å¤¹ä¸­å°±åŒ…å«AAPT2å·¥å…·ï¼Œç›®å½•ä¸ºï¼ˆSDKç›®å½•/build-tools/version/aapt2ï¼‰ã€‚</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/Fi1D2FYTzHg-7TmjhGnER91BjQ5H?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="aapt2è·¯å¾„.png" title="">
                </div>
                <div class="image-caption">aapt2è·¯å¾„.png</div>
            </figure>
<p>æ‰€ä»¥AAPTçš„ä½œç”¨ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯<strong>åœ¨APKæ‰“åŒ…çš„è¿‡ç¨‹ä¸­å¯¹é™æ€èµ„æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œæ‰“åŒ…</strong>ã€‚</p>
<p>è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼š</p>
<blockquote>
<p>Javaæ–‡ä»¶éœ€è¦ç¼–è¯‘æ‰èƒ½ç”Ÿclassæ–‡ä»¶ï¼Œè¿™ä¸ªæˆ‘èƒ½æ˜ç™½ï¼Œä½†èµ„æºæ–‡ä»¶ç¼–è¯‘åˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿä¸ºä»€ä¹ˆè¦å¯¹èµ„æºåšç¼–è¯‘ï¼Ÿ</p>
</blockquote>
<p>è¿™é‡Œå…ˆæ’ä¸ªçœ¼ï¼Œå¸¦ç€è¿™ä¸ªé—®é¢˜å»æ·±å…¥å­¦ä¹ AAPTï¼Œç„¶åæ…¢æ…¢è§£å¼€è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="AAPT2å¦‚ä½•å·¥ä½œ"><a href="#AAPT2å¦‚ä½•å·¥ä½œ" class="headerlink" title="AAPT2å¦‚ä½•å·¥ä½œ"></a>AAPT2å¦‚ä½•å·¥ä½œ</h2><p>å’ŒAAPTä¸åŒï¼ŒAAPT2æŠŠèµ„æºç¼–è¯‘æ‰“åŒ…è¿‡ç¨‹æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå³ç¼–è¯‘å’Œé“¾æ¥ï¼š</p>
<ul>
<li>ç¼–è¯‘é˜¶æ®µï¼šå°†èµ„æºæ–‡ä»¶ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆflat)</li>
<li>é“¾æ¥é˜¶æ®µï¼šå°†ç¼–è¯‘åçš„æ–‡ä»¶åˆå¹¶ï¼Œæ‰“åŒ…æˆå•ç‹¬æ–‡ä»¶ã€‚</li>
</ul>
<blockquote>
<p>é€šè¿‡æŠŠèµ„æºç¼–è¯‘æ‹†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼ŒAAPT2èƒ½å¤Ÿå¾ˆå¥½çš„æå‡èµ„æºç¼–è¯‘çš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œä¹‹å‰ä¸€ä¸ªèµ„æºæ–‡ä»¶å‘ç”Ÿå˜åŠ¨ï¼ŒAAPTéœ€è¦åšä¸€å…¨é‡ç¼–è¯‘ï¼ŒAAPT2åªéœ€è¦é‡æ–°ç¼–è¯‘æ”¹å˜çš„æ–‡ä»¶ï¼Œç„¶åå’Œå…¶ä»–æœªå‘ç”Ÿæ”¹å˜çš„æ–‡ä»¶è¿›è¡Œé“¾æ¥å³å¯ã€‚</p>
</blockquote>
<p>AAPT2å¸¸ç”¨å‘½ä»¤ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">äºŒçº§å‘½ä»¤</th>
<th style="text-align:center">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">compile</td>
<td style="text-align:center">ç¼–è¯‘èµ„æºï¼Œç”¨äºé“¾æ¥</td>
</tr>
<tr>
<td style="text-align:center">link</td>
<td style="text-align:center">é“¾æ¥èµ„æºè‡³ä¸€ä¸ªapk</td>
</tr>
<tr>
<td style="text-align:center">â€¦</td>
<td style="text-align:center">å…¶å®ƒå‘½ä»¤ï¼Œé€šè¿‡<code>aapt2 -h</code>æŸ¥çœ‹</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Compileå‘½ä»¤"><a href="#Compileå‘½ä»¤" class="headerlink" title="Compileå‘½ä»¤"></a>Compileå‘½ä»¤</h3><p>ComplieæŒ‡ä»¤ç”¨äºç¼–è¯‘èµ„æºï¼ŒAAPT2æä¾›å¤šä¸ªé€‰é¡¹ä¸Compileå‘½ä»¤æ­é…ä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/FnCbyMrXOigcxISFpeojInoEP4Fh?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="aapt2å‘½ä»¤é€‰é¡¹.png" title="">
                </div>
                <div class="image-caption">aapt2å‘½ä»¤é€‰é¡¹.png</div>
            </figure>
<p>Compileçš„ä¸€èˆ¬ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aapt2 compile path-to-input-files [options] -o output-directory/</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Compile å‘½ä»¤ä¼šå¯¹è¾“å…¥çš„èµ„æºæ–‡ä»¶çš„è·¯å¾„åšæ ¡éªŒï¼Œè¾“å…¥æ–‡ä»¶çš„è·¯å¾„å¿…é¡»æ»¡è¶³path/resource-type[config]/fileï¼Œå¦åˆ™ä¼šç¼–è¯‘æŠ¥é”™ï¼šerror: bad resource path.</p>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/FqQVM_68gVDZVPVS-x3kVehUf5Po?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="aapt2ç¼–è¯‘æŠ¥é”™.png" title="">
                </div>
                <div class="image-caption">aapt2ç¼–è¯‘æŠ¥é”™.png</div>
            </figure>
<p>æ–°å»ºä¸€ä¸ªç›®å½•drawable-hdpiï¼ŒæŠŠç”¨æ¥æµ‹è¯•çš„å›¾ç‰‡æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aapt2 compile drawable-hdpi/aapt2è·¯å¾„.png -o .</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°å½“å‰ç›®å½•å¤šäº†ä¸€ä¸ªdrawable-hdpi_aapt2.flatçš„æ–‡ä»¶ã€‚</p>
<p>åœ¨Android Studioä¸­ï¼Œå¯ä»¥åœ¨app/build/intermediates/merged_res/debug/ ç›®å½•ä¸‹æ‰¾åˆ°ç¼–è¯‘ç”Ÿæˆçš„.flatæ–‡ä»¶ã€‚</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/FtTzF2KXRLIASXXu-IKcovhR9wGH?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="android studioæ‰“åŒ…äº§ç”Ÿçš„flatæ–‡ä»¶.png" title="">
                </div>
                <div class="image-caption">android studioæ‰“åŒ…äº§ç”Ÿçš„flatæ–‡ä»¶.png</div>
            </figure>
<p>å½“ç„¶Compileä¹Ÿæ”¯æŒç¼–è¯‘å¤šä¸ªæ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aapt2 compile path-to-input-files1 path-to-input-files2 [options] -o output-directory/</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘æ•´ä¸ªç›®å½•,éœ€è¦åˆ¶å®šæ•°æ®æ–‡ä»¶ï¼Œç¼–è¯‘äº§ç‰©æ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼ŒåŒ…å«ç›®å½•ä¸‹æ‰€æœ‰çš„èµ„æºï¼Œé€šè¿‡æ–‡ä»¶åæŠŠèµ„æºç›®å½•ç»“æ„æ‰å¹³åŒ–ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aapt2 compile --dir .../res [options] -o output-directory/resource.ap_</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ‰¾ä¸ªç®€å•çš„Androidé¡¹ç›®æµ‹è¯•ä¸‹ï¼Œé¦–å…ˆè¿›åˆ°é¡¹ç›®çš„<code>app/src/main</code>ç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aapt2 compile --dir ./res -o resource.ap_</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°äº§ç”Ÿäº†ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œç”¨å‘½ä»¤<code>unzip -lv resource.ap_</code>æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æ˜¯ä¸€å †<code>.flat</code>çš„æ–‡ä»¶</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/Fiu1UOXFwhx9Vj8_8jHACQLIXW7N?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="aapt2 compileç¼–è¯‘ç›®å½•.png" title="">
                </div>
                <div class="image-caption">aapt2 compileç¼–è¯‘ç›®å½•.png</div>
            </figure>
<p>éšä¾¿æ‰¾å…¶ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æ‰“å¼€ï¼Œæ˜¯ä¹±ç çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªFLATæ–‡ä»¶æ˜¯åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å…ˆæ¥ç€çœ‹aapt2çš„é“¾æ¥é˜¶æ®µï¼Œæ™šç‚¹å†æ¢è®¨è¿™ä¸ªè¯é¢˜ã€‚</p>
<h3 id="Linkå‘½ä»¤"><a href="#Linkå‘½ä»¤" class="headerlink" title="Linkå‘½ä»¤"></a>Linkå‘½ä»¤</h3><p>åœ¨é“¾æ¥é˜¶æ®µï¼ŒAAPT2 ä¼šåˆå¹¶åœ¨ç¼–è¯‘é˜¶æ®µç”Ÿæˆçš„æ‰€æœ‰ä¸­é—´æ–‡ä»¶ï¼ˆ.flatæ–‡ä»¶ï¼‰ï¼Œå¹¶å°†å®ƒä»¬æ‰“åŒ…æˆZIPåŒ…ï¼ˆæœ€ç»ˆAPKçš„åŸå‹ï¼Œç”±äºä¸åŒ…æ‹¬DEXæ–‡ä»¶ä¸”æœªç­¾åï¼Œæ‰€ä»¥æ— æ³•æ­£å¸¸å®‰è£…ï¼‰ã€‚</p>
<p>é“¾æ¥èµ„æºä½¿ç”¨linkå­å‘½ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">aapt2 link -o build/output.apk \</span><br><span class="line">    -I <span class="variable">$ANDROID_HOME</span>/platforms/android-29/android.jar \</span><br><span class="line">    --manifest build/intermediates/manifests/full/debug/AndroidManifest.xml \</span><br><span class="line">    build/layout_activity_main.xml.flat \</span><br><span class="line">    build/values_styles.arsc.flat \</span><br><span class="line">    build/values_colors.arsc.flat \</span><br><span class="line">    build/values_strings.arsc.flat \</span><br><span class="line">    build/mipmap-xxxhdpi_ic_launcher.png.flat \</span><br><span class="line">    build/mipmap-xxxhdpi_ic_launcher_round.png.flat</span><br></pre></td></tr></table></figure>
<h3 id="AAPT2å®¹å™¨"><a href="#AAPT2å®¹å™¨" class="headerlink" title="AAPT2å®¹å™¨"></a>AAPT2å®¹å™¨</h3><p>FLATæ–‡ä»¶æ˜¯AAPT2ç¼–è¯‘çš„äº§ç‰©æ–‡ä»¶ï¼Œä¹Ÿå«åšAAPT2å®¹å™¨ï¼Œæ–‡ä»¶ç”±æ–‡ä»¶å¤´å’Œèµ„æºé¡¹ä¸¤å¤§éƒ¨åˆ†ç»„æˆã€‚</p>
<ol>
<li>æ–‡ä»¶å¤´</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Size(in bytes)</th>
<th style="text-align:center">Field</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">magic</td>
<td style="text-align:left">AAPT2å®¹å™¨æ–‡ä»¶æ ‡è¯†ï¼ŒAAPTæˆ–0x54504141</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">version</td>
<td style="text-align:left">AAPT2å®¹å™¨ç‰ˆæœ¬</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">entry_count</td>
<td style="text-align:left">å®¹å™¨ä¸­åŒ…å«çš„æ¡ç›®æ•°(ä¸€ä¸ªflatæ–‡ä»¶ä¸­å¯ä»¥åŒ…å«å¤šä¸ªèµ„æºé¡¹)</td>
</tr>
</tbody>
</table>
</div>
<p>ç”¨<code>UltraEdit</code>ç¼–è¾‘ä¸Šé¢ä»»æ„ä¸€ä¸ªflatæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/FsFqakTFKfyvq4U4deD3pwN0AMt6?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="UEæ‰“å¼€flatæ–‡ä»¶.png" title="">
                </div>
                <div class="image-caption">UEæ‰“å¼€flatæ–‡ä»¶.png</div>
            </figure>
<p>å¯ä»¥çœ‹åˆ°å‰4ä¸ªå­—èŠ‚æ˜¯<code>0x54504141</code>(ä¸ºå•¥ä¸æ˜¯0x41415054?å› ä¸ºæ˜¯å°ç«¯æœºå™¨)ï¼Œæ ‡è¯†è¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªAAPTå®¹å™¨æ–‡ä»¶ï¼›ç´§æ¥ç€4ä¸ªå­—èŠ‚æ˜¯<code>0x00000001</code>è¡¨ç¤ºè¯¥æ–‡ä»¶çš„ç‰ˆæœ¬å·æ˜¯1ï¼Œæ¥ç€4ä¸ªå­—èŠ‚æ˜¯<code>0x000000001</code>è¡¨ç¤ºè¯¥æ–‡ä»¶åªæœ‰ä¸€ä¸ªèµ„æºé¡¹ã€‚</p>
<blockquote>
<p>å…³äºäºŒè¿›åˆ¶æ–‡ä»¶çš„é€†å‘å·¥å…·ï¼Œç±»Unixç³»ç»Ÿéƒ½è‡ªå¸¦<code>xxd</code>å‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥è¾“å‡ºäºŒè¿›åˆ¶æ–‡ä»¶çš„åå…­è¿›åˆ¶æ ¼å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxd values-de_values-de.arsc.flat</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä½¿ç”¨<code>Vim</code>æ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶ååœ¨å‘½ä»¤æ¨¡å¼ä¸­è¾“å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%!xxd</span><br></pre></td></tr></table></figure>
<p>åœ¨Windowsç³»ç»Ÿä¸­ï¼Œåˆ™å¯ä»¥ç”¨UE(UltraEdit)æ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶åˆ†æã€‚</p>
</blockquote>
<ol>
<li>èµ„æºé¡¹</li>
</ol>
<p>å…ˆç”¨ä¸€ä¸ªè¡¨æ ¼çœ‹ä¸‹èµ„æºé¡¹çš„æ•°æ®æ ¼å¼ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Size(in bytes)</th>
<th style="text-align:center">Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">entry_type</td>
<td>èµ„æºç±»å‹ï¼Œç›®å‰ä»…æ”¯æŒ2ç§ç±»å‹ï¼ŒRES_TABLEå’ŒRES_FILE</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center">entry_length</td>
<td>èµ„æºæ–‡ä»¶æ•°æ®é•¿åº¦</td>
</tr>
<tr>
<td style="text-align:center">è‹¥å¹²</td>
<td style="text-align:center">entry_data</td>
<td>èµ„æºæ•°æ®</td>
</tr>
</tbody>
</table>
</div>
<p>entry_typeå€¼åˆ†ä¸ºä¸¤ç§ç±»å‹:</p>
<ul>
<li>å½“entry_typeçš„å€¼ç­‰äº<code>0x00000000</code>æ—¶ï¼Œä¸º<code>RES_TABLE</code>ç±»å‹ã€‚</li>
<li>å½“entry_typeçš„å€¼ç­‰äº<code>0x00000001</code>æ—¶ï¼Œä¸º<code>RES_FILE</code>ç±»å‹ã€‚</li>
</ul>
<p>å¾ˆæ˜¾ç„¶æˆ‘ä»¬è¿™é‡Œæ‰“å¼€çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªRES_FILEç±»å‹ï¼Œå› ä¸ºè¿™é‡Œçš„entry_typeä¸º<code>0x00000001</code>ã€‚</p>
<p>æ¥ç€8ä¸ªå­—èŠ‚<code>0x000000000001BFC8</code>è¡¨ç¤ºè¯¥èµ„æºæ–‡ä»¶çš„é•¿åº¦ï¼Œè½¬ä¸ºåè¿›åˆ¶ï¼Œä¹Ÿå³114632ä¸ªå­—èŠ‚ã€‚æ¢ç®—æˆä»¥kä¸ºå•ä½ï¼Œå°±æ˜¯111.95kï¼Œæˆ‘ä»¬æŸ¥çœ‹èµ„æºæ–‡ä»¶å¤§å°ä¹Ÿåˆšå¥½æ˜¯112kã€‚</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/Ft1NO7v_GkvR_Rn5N_cfJYQL4doZ" alt="èµ„æºæ–‡ä»¶å¤§å°.png" title="">
                </div>
                <div class="image-caption">èµ„æºæ–‡ä»¶å¤§å°.png</div>
            </figure>
<p>æ¥ä¸‹æ¥å°±æ˜¯èµ„æºæ•°æ®äº†ï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹RES_FILEæ–‡ä»¶çš„æ ¼å¼ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Size(inf bytes)</th>
<th style="text-align:center">Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">header_size</td>
<td>headerçš„é•¿åº¦</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center">data_size</td>
<td>dataçš„é•¿åº¦</td>
</tr>
<tr>
<td style="text-align:center">header_size</td>
<td style="text-align:center">header</td>
<td>è¡¨ç¤ºprotobufåºåˆ—åŒ–çš„CompiledFileç»“æ„</td>
</tr>
<tr>
<td style="text-align:center">x</td>
<td style="text-align:center">header_padding</td>
<td>0-3ä¸ªå¡«å……å­—èŠ‚ï¼Œç”¨äºdata 32ä½å¯¹é½</td>
</tr>
<tr>
<td style="text-align:center">data_size</td>
<td style="text-align:center">data</td>
<td>èµ„æºæ–‡ä»¶å†…å®¹(PNG, äºŒè¿›åˆ¶, XMLæˆ–è€…protobufåºåˆ—åŒ–çš„XmlNodeç»“æ„)</td>
</tr>
<tr>
<td style="text-align:center">y</td>
<td style="text-align:center">data_paddning</td>
<td>0-3ä¸ªå¡«å……å­—èŠ‚ï¼Œç”¨äºdata 32ä½å¯¹é½</td>
</tr>
</tbody>
</table>
</div>
<p>å¯ä»¥ç”¨ä¸€å¼ å›¾çœ‹ä¸‹å®Œæ•´çš„RES_FILEç±»å‹çš„flatæ–‡ä»¶çš„æ ¼å¼ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/FrdQkv6mPBGr6Akv0YhonaOTyH07?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="RES_FILEç±»å‹çš„flatæ–‡ä»¶æ ¼å¼.png" title="">
                </div>
                <div class="image-caption">RES_FILEç±»å‹çš„flatæ–‡ä»¶æ ¼å¼.png</div>
            </figure>
<p>æ¥ç€çœ‹åˆšæ‰æ‰“å¼€çš„.flatæ–‡ä»¶ï¼Œ<code>0000003F</code>4ä¸ªå­—èŠ‚ï¼Œä¹Ÿå³63è¡¨ç¤ºè¯¥RES_FILEçš„headeré•¿åº¦æ˜¯63ä¸ªå­—èŠ‚ï¼Œç„¶åæ¥ç€8ä¸ªå­—èŠ‚<code>0x000000000001BF7B</code>è¡¨ç¤ºæ•°æ®æ–‡ä»¶çš„é•¿åº¦ï¼Œä¹Ÿå³114555ä¸ªå­—èŠ‚ã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„data_lengthå’Œä¸Šé¢çš„entry_lengthä¸æ˜¯åŒä¸€ä¸ªé•¿åº¦ï¼Œdata_lengthæŒ‡çš„æ˜¯ç¼–è¯‘ä¹‹å‰åŸå§‹æ–‡ä»¶çš„æ•°æ®é•¿åº¦(è¿™é‡ŒæŒ‡åŸå§‹pngæ–‡ä»¶)ï¼Œè€Œentry_lengthæŒ‡çš„æ˜¯ç¼–è¯‘ä¹‹åæ•´ä¸ªflatæ–‡ä»¶çš„é•¿åº¦ã€‚</p>
</blockquote>
<p>æ¥ä¸‹æ¥å°±æ˜¯headeréƒ¨åˆ†ï¼Œå‰é¢è®¡ç®—äº†headerçš„é•¿åº¦æ˜¯63ä½ï¼Œæ‰€ä»¥è¿™é‡Œ63ä¸ªå­—èŠ‚è¡¨ç¤ºheaderï¼Œç„¶åç´§æ¥ç€ä¸€ä¸ª<code>00</code>æ˜¯header_paddingç”¨æ¥åš32ä½å¯¹é½ã€‚</p>
<p>ç„¶åæ¥ä¸‹æ¥çš„114555ä¸ªå­—èŠ‚å°±æ˜¯åŸå§‹æ–‡ä»¶çš„æ•°æ®å†…å®¹(ä¹Ÿå³æ˜¯pngçš„å†…å®¹)ï¼Œæœ€åä¸€ä¸ª<code>00</code>æ˜¯ç”¨æ¥å¡«å……æ•°æ®åš32ä½å¯¹é½çš„ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬å‰é¢è®¡ç®—äº†æ•´ä¸ªflatæ–‡ä»¶çš„å¤§å°æ˜¯114632ä¸ªå­—èŠ‚ï¼Œ114632=4(ç”¨æ¥å­˜å‚¨headerçš„é•¿åº¦)+8(ç”¨æ¥å­˜å‚¨dataçš„é•¿åº¦)+63(header)+1(1ä¸ªå¡«å……å­—èŠ‚ï¼Œç”¨æ¥å¡«å……headerè¿›è¡Œ32ä½å¯¹é½)+114555(ç¼–è¯‘ä¹‹å‰æ•´ä¸ªpngçš„æ–‡ä»¶é•¿åº¦)+1(1ä¸ªå¡«å……å­—èŠ‚ï¼Œç”¨æ¥å¡«å……dataè¿›è¡Œ32ä½å¯¹é½)</p>
<p>æœ€åç”¨ä¸€å¼ å›¾çœ‹ä¸‹ä¸Šè¾¹åˆ†æçš„RES_FILEæ ¼å¼ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/FqcguIF45SpTniymtYf6H89zRQQ5" alt="RES_FILEæ ¼å¼å›¾ç¤º.png" title="">
                </div>
                <div class="image-caption">RES_FILEæ ¼å¼å›¾ç¤º.png</div>
            </figure>
<p>å¦ä¸€ç§æ ¼å¼<code>RES_TABLE</code>æ ¼å¼æ¯”è¾ƒç®€å•ï¼Œå…¶å®å°±æ˜¯ResourceTableçš„<code>protobuf</code>åºåˆ—åŒ–ç»“æœã€‚æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Top level message representing a resource table.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">ResourceTable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²æ± </span></span><br><span class="line">    StringPool source_pool = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// ç”¨äºç”Ÿæˆèµ„æºid</span></span><br><span class="line">    <span class="keyword">repeated</span> Package <span class="keyword">package</span> = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// èµ„æºå åŠ å±‚ç›¸å…³</span></span><br><span class="line">    <span class="keyword">repeated</span> Overlayable overlayable = <span class="number">3</span>;</span><br><span class="line">    <span class="comment">// å·¥å…·ç‰ˆæœ¬</span></span><br><span class="line">    <span class="keyword">repeated</span> ToolFingerprint tool_fingerprint = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>èµ„æºè¡¨ï¼ˆResourceTableï¼‰ä¸­åŒ…å«ï¼š</p>
<p><strong>StringPool</strong>ï¼šå­—ç¬¦ä¸²æ± ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ä¸ºäº†æŠŠèµ„æºæ–‡ä»¶ä¸­çš„stringå¤ç”¨èµ·æ¥ï¼Œä»è€Œå‡å°‘ä½“ç§¯ï¼Œèµ„æºæ–‡ä»¶ä¸­å¯¹åº”çš„å­—ç¬¦ä¸²ä¼šè¢«æ›¿æ¢ä¸ºå­—ç¬¦ä¸²æ± ä¸­çš„ç´¢å¼•ã€‚</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">StringPool</span> </span>&#123;</span><br><span class="line">  <span class="built_in">bytes</span> data = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Package</strong>ï¼šåŒ…å«èµ„æºidçš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// èµ„æºidçš„åŒ…idéƒ¨åˆ†ï¼Œåœ¨ [0x00, 0xff] èŒƒå›´å†…</span><br><span class="line">message PackageId &#123;</span><br><span class="line">  uint32 id = 1;</span><br><span class="line">&#125;</span><br><span class="line">// èµ„æºidçš„å‘½åè§„åˆ™</span><br><span class="line">message Package &#123;</span><br><span class="line">  // [0x02, 0x7f) ç®€å•çš„è¯´ï¼Œç”±ç³»ç»Ÿä½¿ç”¨</span><br><span class="line">  // 0x7f åº”ç”¨ä½¿ç”¨</span><br><span class="line">  // (0x7f, 0xff] é¢„ç•™Id</span><br><span class="line">  PackageId package_id = 1;</span><br><span class="line">  // åŒ…å</span><br><span class="line">  string package_name = 2;</span><br><span class="line">  // èµ„æºç±»å‹ï¼Œå¯¹åº”string, layout, xml, dimen, attrç­‰ï¼Œå…¶å¯¹åº”çš„èµ„æºidåŒºé—´ä¸º[0x01, 0xff]</span><br><span class="line">  repeated Type type = 3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>èµ„æºidçš„å‘½ä»¤æ–¹å¼éµå¾ª0xPPTTEEEEçš„è§„åˆ™ï¼Œå…¶ä¸­PPå¯¹åº”PackageIdï¼Œä¸€èˆ¬åº”ç”¨ä½¿ç”¨çš„èµ„æºä¸º7fï¼ŒTTå¯¹åº”çš„æ˜¯èµ„æºæ–‡ä»¶å¤¹çš„åæˆï¼Œæœ€å4ä½ä¸ºèµ„æºçš„idï¼Œä»0å¼€å§‹ã€‚</p>
</blockquote>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡æœ¬æ–‡ï¼Œäº†è§£åˆ°<em>AAPT2</em>ï¼ˆ<em>Android</em> èµ„æºæ‰“åŒ…å·¥å…·ï¼‰æ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·ï¼Œ<em>Android Studio</em> å’Œ <em>Android Gradle Plugin</em> ä½¿ç”¨å®ƒæ¥ç¼–è¯‘å’Œæ‰“åŒ…åº”ç”¨çš„èµ„æºã€‚<em>AAPT2</em> ä¼šè§£æèµ„æºã€ä¸ºèµ„æºç¼–åˆ¶ç´¢å¼•ï¼Œå¹¶å°†èµ„æºç¼–è¯‘ä¸ºé’ˆå¯¹ Android å¹³å°è¿›è¡Œè¿‡ä¼˜åŒ–çš„äºŒè¿›åˆ¶æ ¼å¼ã€‚</p>
<p>åœ¨æœ¬æ–‡çš„å¼€å¤´ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹çš„é—®é¢˜ï¼š</p>
<blockquote>
<p>Javaæ–‡ä»¶éœ€è¦ç¼–è¯‘æ‰èƒ½ç”Ÿ.classæ–‡ä»¶ï¼Œè¿™ä¸ªæˆ‘èƒ½æ˜ç™½ï¼Œä½†èµ„æºæ–‡ä»¶ç¼–è¯‘åˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿä¸ºä»€ä¹ˆè¦å¯¹èµ„æºåšç¼–è¯‘ï¼Ÿ</p>
</blockquote>
<p>ä¸»è¦åŸå› åœ¨äº <em>AAPT2</em> å°†èµ„æºæ‰“åŒ…è¿‡ç¨‹æ‹†åˆ†æˆäº†ä¸¤ä¸ªé˜¶æ®µï¼šã€Œç¼–è¯‘é˜¶æ®µã€å’Œã€Œé“¾æ¥é˜¶æ®µã€ï¼Œä¸ºäº†åœ¨é“¾æ¥é˜¶æ®µå¾—åˆ°èµ„æºæ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šèµ„æºåç§°ã€é…ç½®ä¿¡æ¯ï¼ˆ<em>Configuration</em>ï¼‰ ç­‰ï¼Œå› æ­¤ï¼Œç›´æ¥å°†èµ„æºçš„å…ƒä¿¡æ¯è¿åŒèµ„æºæœ¬èº«ä¸€åŒç¼–ç è¿› <em>AAPT2</em> å®¹å™¨æ–‡ä»¶ä¸­ï¼Œè¿™æ ·ï¼Œèµ„æºé“¾æ¥çš„è¿‡ç¨‹å¯ä»¥å®Œå…¨ä¸ç¼–è¯‘è¿‡ç¨‹è§£è€¦äº†ï¼Œè€Œä¸”ï¼Œå¯¹äºå¢é‡æ„å»ºæ¥è¯´ï¼Œè¿™æ ·å¤§å¤§æå‡äº†èµ„æºæ‰“åŒ…çš„æ€§èƒ½ã€‚è¿™æ ·å¦‚æœåªæ˜¯ä¿®æ”¹äº†å…¶ä¸­è‹¥å¹²ä¸ªèµ„æºæ–‡ä»¶ï¼Œåˆ™åªéœ€è¦å¯¹è¿™äº›èµ„æºæ–‡ä»¶å•ç‹¬ç¼–è¯‘ç„¶åå†é“¾æ¥ï¼Œè€Œä¸ç”¨å¯¹æ‰€æœ‰çš„èµ„æºæ–‡ä»¶é‡æ–°é“¾æ¥ï¼Œå¤§å¤§æé«˜äº†æ€§èƒ½ã€‚</p>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://booster.johnsonlee.io/architecture/aapt2-output-reversing.html#flat-%E4%B8%8E-aapt-%E4%BA%A7%E7%89%A9%E7%9A%84%E5%85%B3%E7%B3%BB">AAPT2äº§ç‰©é€†å‘</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000040864174">Androidæ„å»ºå·¥å…·â€”AAPT2æºç è§£æï¼ˆä¸€ï¼‰</a></li>
</ul>

    

        <a href="/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3Android%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E2%80%94%E2%80%94AAPT2/" class="post-more waves-effect waves-button">
            Continue reading...
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aapt2/" rel="tag">aapt2</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-ä»é›¶å¼€å§‹å­¦æ·±åº¦å­¦ä¹ â€”â€”æ³°å‹’å…¬å¼"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2021-01-15 20:18:44" datetime="2021-01-15T12:18:44.000Z"  itemprop="datePublished">2021-01-15</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">æ·±åº¦å­¦ä¹ </a></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94%E6%B3%B0%E5%8B%92%E5%85%AC%E5%BC%8F/">ä»é›¶å¼€å§‹å­¦æ·±åº¦å­¦ä¹ â€”â€”æ³°å‹’å…¬å¼</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <div align="middle"><iframe src="//player.bilibili.com/player.html?aid=11251323&bvid=BV1Gx411Y7cz&cid=18609209&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe></div>



<blockquote>
<p>æ³°å‹’å…¬å¼ï¼ˆä¹Ÿå« æ³°å‹’å±•å¼€å¼ã€æ³°å‹’å¤šé¡¹å¼ï¼‰<br>æ³°å‹’çº§æ•°</p>
</blockquote>
<p>å®ƒæ˜¯<strong>å¾®ç§¯åˆ†å­¦</strong>ä¸‹çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œä¸ä¹‹æœ‰å…³è”çš„æœ‰ï¼šå¦‚<strong>æ³°å‹’å®šç†</strong>ï¼Œ<strong>å¤šå…ƒæ³°å‹’å…¬å¼</strong>ï¼Œä»¥<strong>æ‹‰æ ¼æœ—æ—¥å‹ä½™é¡¹</strong>ä¸ºä»£è¡¨çš„å„ç±»<strong>ä½™é¡¹</strong>ï¼Œ<strong>å®¡æ•›æ³•</strong>ï¼Œ<strong>ç‰›é¡¿å·®å€¼å…¬å¼</strong>ï¼ˆç‰›é¡¿çº§æ•°ï¼‰ï¼ˆåˆ—å‡ºä¸ºäº†è¿›è¡Œæ ‘çŠ¶çŸ¥è¯†æ•´åˆå’Œæ¢³ç†ï¼‰</p>
<h4 id="ä»€ä¹ˆæ˜¯æ³°å‹’å…¬å¼"><a href="#ä»€ä¹ˆæ˜¯æ³°å‹’å…¬å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³°å‹’å…¬å¼"></a>ä»€ä¹ˆæ˜¯æ³°å‹’å…¬å¼</h4><h5 id="åŸºæœ¬å®šä¹‰"><a href="#åŸºæœ¬å®šä¹‰" class="headerlink" title="åŸºæœ¬å®šä¹‰"></a>åŸºæœ¬å®šä¹‰</h5><p>æ³°å‹’å…¬å¼ä¸ºï¼š$f(x)_{Taylor}=\sum_{n=0}^{\infty}{\frac{f^{(n)}(a)}{n!}} \times (x-a)^n=f(a)+\frac{f^\prime(a)}{1!}(x-a)+\frac{f^{(2)}(a)}{2!}(x-a)^2+â€¦+\frac{f^{(n)}(a)}{n!}(x-a)^n+R_n(x)$</p>
<p>åˆ†æä¸‹æ¯éƒ¨åˆ†è¡¨ç¤ºçš„å«ä¹‰ï¼š</p>

    

        <a href="/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94%E6%B3%B0%E5%8B%92%E5%85%AC%E5%BC%8F/" class="post-more waves-effect waves-button">
            Continue reading...
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E5%AD%A6/" rel="tag">æ•°å­¦</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">æ·±åº¦å­¦ä¹ </a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-ä»é›¶å¼€å§‹å­¦æ·±åº¦å­¦ä¹ â€”â€”æ–¹å‘å¯¼æ•°ä¸æ¢¯åº¦"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2021-01-14 21:34:57" datetime="2021-01-14T13:34:57.000Z"  itemprop="datePublished">2021-01-14</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">æ·±åº¦å­¦ä¹ </a></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94%E6%96%B9%E5%90%91%E5%AF%BC%E6%95%B0%E4%B8%8E%E6%A2%AF%E5%BA%A6/">ä»é›¶å¼€å§‹å­¦æ·±åº¦å­¦ä¹ â€”â€”æ–¹å‘å¯¼æ•°ä¸æ¢¯åº¦</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <h2 id="åå¯¼æ•°"><a href="#åå¯¼æ•°" class="headerlink" title="åå¯¼æ•°"></a>åå¯¼æ•°</h2><h3 id="å›é¡¾å¯¼æ•°å®šä¹‰"><a href="#å›é¡¾å¯¼æ•°å®šä¹‰" class="headerlink" title="å›é¡¾å¯¼æ•°å®šä¹‰"></a>å›é¡¾å¯¼æ•°å®šä¹‰</h3><p>åœ¨çœ‹åå¯¼æ•°çš„å®šä¹‰ä¹‹å‰ï¼Œå›é¡¾ä¸‹å¯¼æ•°çš„å®šä¹‰ï¼š$y=f(x), x_0\in D, f^\prime(x_0)=\lim_{\Delta x -&gt; 0}\frac{\Delta y}{\Delta x}æˆ–è€…f^\prime(x_0) = \lim_{x-&gt;x_0}\frac{f(x) - f(x_0)}{x - x_0}$</p>
<p>ç„¶åè¿˜æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p>
<ol>
<li>$f(x)åœ¨x=x_0å¯å¯¼\Rightarrow f(x)åœ¨x=x_0è¿ç»­ï¼Œåä¹‹ä¸æˆç«‹$</li>
<li>$f(x)åœ¨x=x_0å¯å¯¼ \Leftrightarrow f(x)åœ¨x=x_0å¯å¾®$</li>
</ol>
<h3 id="åå¯¼æ•°å®šä¹‰"><a href="#åå¯¼æ•°å®šä¹‰" class="headerlink" title="åå¯¼æ•°å®šä¹‰"></a>åå¯¼æ•°å®šä¹‰</h3><p>$\zeta=f(x, y), ((x, y)\in D), \forall M_0(x_0, y_0)\in D$</p>
<p>ç§° $\Delta \zeta_x = f(x_0 + \Delta x, y_0) - f(x_0, y_0)$ ä¸º $f(x, y)$ åœ¨ $M_0$ å¤„å…³äºxçš„<strong>åå¢é‡</strong></p>
<p>ç§° $\Delta \zeta_y = f(x_0, y_0 + y_0 + \Delta y) - f(x_0, y_0)$ ä¸º $f(x, y)$ åœ¨ $M_0$ å¤„å…³äºyçš„<strong>åå¢é‡</strong></p>
<p>ç§° $\Delta \zeta = f(x_0 + \Delta x, y_0 + \Delta y) - f(x_0, y_0) æˆ– \Delta \zeta = f(x, y) - f(x_0, y_0)$ ä¸º $f(x, y)$ åœ¨ $M_0$ å¤„çš„<strong>å…¨å¢é‡</strong></p>
<p>è‹¥ $\lim_{\Delta x-&gt; 0} \frac{\Delta \zeta x}{\Delta x} \exists æˆ– \lim_{x-&gt;x_0} \frac{f(x, y_0)-f(x_0, y_0)}{x-x_0} \exists$  ç§° $f(x, y)$ åœ¨ $M_0$ å¤„å…³äºxå¯åå¯¼ï¼Œæé™å€¼ç§°ä¸º $f(x, y)$ åœ¨ $M_0$ å¤„å…³äºxçš„åå¯¼æ•°ï¼Œè®°ä¸º$f^\prime_{x}(x_0, y_0)$ æˆ–è€… $\frac{\partial \zeta}{\partial x}|_{(x_0, y_0)}$</p>
<p>è‹¥ $\lim_{\Delta y-&gt; 0} \frac{\Delta \zeta y}{\Delta y} \exists æˆ– \lim_{y-&gt;y_0} \frac{f(x_0, y)-f(x_0, y_0)}{y-y_0} \exists$  ç§° $f(x, y)$ åœ¨ $M_0$ å¤„å…³äºyå¯åå¯¼ï¼Œæé™å€¼ç§°ä¸º $f(x, y)$ åœ¨ $M_0$ å¤„å…³äºyçš„åå¯¼æ•°ï¼Œè®°ä¸º$f^\prime_{y}(x_0, y_0)$ æˆ–è€… $\frac{\partial \zeta}{\partial y}|_{(x_0, y_0)}$</p>
<p>è‹¥ $\forall (x, y) \in D, f(x, y)$ åœ¨ $(x, y)$ å¤„å¯¹x, yçš†å¯ä»¥åå¯¼ï¼Œç§° $f^\prime_x(x, y), f^\prime_y(x, y)$ ä¸º $f(x, y)$ å¯¹ x, yçš„åå¯¼å‡½æ•°ï¼Œç®€ç§°åå¯¼æ•°ã€‚</p>
<h3 id="åå¯¼æ•°çš„è®¡ç®—"><a href="#åå¯¼æ•°çš„è®¡ç®—" class="headerlink" title="åå¯¼æ•°çš„è®¡ç®—"></a>åå¯¼æ•°çš„è®¡ç®—</h3><p>ä¾‹. $\zeta = f(x, y) = x^2y + \ln(x+y^2)ï¼Œæ±‚\frac{\partial \zeta}{\partial x}, \frac{\partial \zeta}{\partial y}$</p>
<p>è§£ï¼š$\frac{\partial \zeta}{\partial x} = 2xy + \frac{1}{x+y^2} $</p>
<p>$\frac{\partial \zeta}{\partial y} = x^2 + \frac{1}{x+y^2} \cdot 2y$</p>
<h3 id="åå¯¼æ•°çš„å‡ ä½•æ„ä¹‰"><a href="#åå¯¼æ•°çš„å‡ ä½•æ„ä¹‰" class="headerlink" title="åå¯¼æ•°çš„å‡ ä½•æ„ä¹‰"></a>åå¯¼æ•°çš„å‡ ä½•æ„ä¹‰</h3><p>$\zeta=f(x, y), ((x, y)\in D), \forall M_0(x_0, y_0)\in D$</p>
<p>$\frac{\partial \zeta}{\partial x}$çš„å‡ ä½•æ„ä¹‰æ˜¯ï¼šé€šè¿‡è¯¥ç‚¹(x, y)ä¸”ä¸ZOXå¹³é¢å¹³è¡Œçš„å¹³é¢ä¸ $\zeta$ çš„äº¤çº¿ä¸Šï¼Œè¯¥ç‚¹(x, y)çš„æ•ˆç‡ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://img.heshipeng.com/202205081039462.png" alt="image-20220508103959300" style="zoom:50%;" /></p>
<p>ä¹‹æ‰€ä»¥å–ä¸ZOXå¹³è¡Œçš„å¹³é¢ï¼Œæ˜¯ä¸ºäº†ä¿æŒyæ–¹å‘çš„å¢é‡ä¸º0ã€‚</p>
<p>$\frac{\partial \zeta}{\partial y}$ çš„å‡ ä½•æ„ä¹‰ç±»ä¼¼ã€‚</p>
<p><img src="https://img.heshipeng.com/202205081044383.png" alt="image-20220508104412299" style="zoom:50%;" /></p>
<h3 id="é«˜é˜¶åå¯¼æ•°"><a href="#é«˜é˜¶åå¯¼æ•°" class="headerlink" title="é«˜é˜¶åå¯¼æ•°"></a>é«˜é˜¶åå¯¼æ•°</h3><p>è®¾å‡½æ•° $z=f(x, y)$ åœ¨åŒºåŸŸ $D$ å†…å…·æœ‰åå¯¼å‡½æ•° $\frac{\partial z}{\partial x} = f_x(x, y), \ \frac{\partial z}{\partial y} = f_y(x, y)$ ï¼Œå¦‚æœå…³äºåå¯¼å‡½æ•° $f_x(x, y), \ f_y(x, y)$ çš„åå¯¼æ•°ä¹Ÿå­˜åœ¨ï¼Œé‚£ä¹ˆç§°ä»–ä»¬æ˜¯å‡½æ•° $z=f(x, y)$ çš„äºŒé˜¶åå¯¼æ•°ï¼Œå››ä¸ªäºŒé˜¶åå¯¼æ•°å¦‚ä¸‹ï¼š</p>
<p>$\frac{\partial}{\partial x}(\frac{\partial z}{\partial x}) = f_{xx}(x, y), \ \frac{\partial}{\partial y}(\frac{\partial z}{\partial y}) = f_{yy}(x, y), \ \frac{\partial}{\partial x}(\frac{\partial z}{\partial y}) = f_{yx}(x, y), \ \frac{\partial}{\partial y}(\frac{\partial z}{\partial x}) = f_{xy}(x, y)$</p>
<p>å…¶ä¸­ï¼Œåè¾¹ä¸¤ä¸ªåå¯¼æ•°å«åšæ··åˆåå¯¼æ•°ã€‚åŒæ ·å¯ä»¥å¾—ä¸‰é˜¶ï¼Œå››é˜¶â€¦ä»¥åŠné˜¶åå¯¼æ•°ï¼ŒäºŒé˜¶åŠå…¶ä»¥ä¸Šçš„åå¯¼æ•°ç»Ÿç§°ä¸ºé«˜é˜¶åå¯¼æ•°ã€‚</p>
<h3 id="é«˜é˜¶åå¯¼æ•°çš„è®¡ç®—"><a href="#é«˜é˜¶åå¯¼æ•°çš„è®¡ç®—" class="headerlink" title="é«˜é˜¶åå¯¼æ•°çš„è®¡ç®—"></a>é«˜é˜¶åå¯¼æ•°çš„è®¡ç®—</h3><p>ä¾‹. $z=x^3y^2 - 3xy^3 - xy + 1ï¼Œ\ \frac{\partial^2 z}{\partial x^2}? \ \frac{\partial^2 z}{\partial x \partial y}? \ \frac{\partial^2 z}{\partial y \partial x}? \ \frac{\partial^2 z}{\partial y^2}? \ \frac{\partial^3z}{\partial x^3}? $</p>
<p>è§£ï¼š$\frac{\partial z}{\partial x} = 3x^2y^2 - 3y^3 - y, \ \ \frac{\partial z}{\partial y} = 2x^3y - 9xy^2 - x$</p>
<p>â€‹        $\frac{\partial^2 z}{\partial x^2}=6xy^2, \ \ \frac{\partial^2 z}{\partial x \partial y} = 6x^2y - 9y^2 - 1, \ \ \frac{\partial^2 z}{\partial y \partial x} = 6x^2y - 9y^2 - 1$</p>
<p>â€‹        $\frac{\partial^2 z}{\partial y^2} = 2x^3 - 18xy, \ \ \frac{\partial^3z}{\partial x^3} = 6y^2$  </p>
<h3 id="é«˜é˜¶åå¯¼æ•°çš„æ€§è´¨"><a href="#é«˜é˜¶åå¯¼æ•°çš„æ€§è´¨" class="headerlink" title="é«˜é˜¶åå¯¼æ•°çš„æ€§è´¨"></a>é«˜é˜¶åå¯¼æ•°çš„æ€§è´¨</h3><p>å¦‚æœå‡½æ•° $z=f(x, y)$ çš„ä¸¤ä¸ªäºŒé˜¶æ··åˆåå¯¼æ•° $z=\frac{\partial^2 z}{\partial x \partial y}$ åŠ $\frac{\partial^2 z }{\partial y \partial x}$ åœ¨å®šä¹‰åŸŸDå†…è¿ç»­ï¼Œé‚£ä¹ˆè¯¥åŒºåŸŸå†…è¯¥äºŒé˜¶åå¯¼å¿…ç„¶ç›¸ç­‰ã€‚ </p>
<h2 id="æ–¹å‘å¯¼æ•°"><a href="#æ–¹å‘å¯¼æ•°" class="headerlink" title="æ–¹å‘å¯¼æ•°"></a>æ–¹å‘å¯¼æ•°</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p> å‡è®¾æœ‰$\eta=f(x, y) ((x, y) \in D)$, å…¶å›¾åƒåœ¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ$\eta$çš„å›¾åƒæ˜¯æœ‰ä¸€ä¸ªä¸è§„åˆ™çš„åœ†æŸ±ä½“ç»„æˆï¼Œåœ†æŸ±ä½“çš„é¡¶é¢æ˜¯ä¸€ä¸ªä¸è§„åˆ™çš„æ›²é¢ã€‚</p>
<p><img src="https://img.heshipeng.com/202205072043452.jpeg" alt="WechatIMG100" style="zoom:20%; align: middle;" /></p>
<p>åœ¨åœ†æŸ±ä½“çš„åº•é¢ä»»å–ä¸€ç‚¹$M_0$ï¼Œè¿‡è¿™ä¸ªç‚¹$M_0$éšæœºä½œä¸€æ¡å°„çº¿Lï¼Œå–$M_1(x_0+\Delta x, y_0 + \Delta y) \in L$ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåˆ™$M_0$åˆ°$M_1$çš„è·ç¦»$\rho$ä¸º$\rho=\sqrt{(\Delta x)^2 + (\Delta y)^2}$ã€‚</p>
<p>è¿‡è¿™æ¡å°„çº¿Lä½œä¸€ä¸ªå‚ç›´äºåœ†æŸ±ä½“åº•é¢çš„å¹³é¢ï¼Œè¿™ä¸ªå¹³é¢ä¸åœ†æŸ±ä½“çš„é¡¶é¢å³ä¸è§„åˆ™çš„æ›²é¢ç›¸äº¤äº§ç”Ÿä¸€æ¡å¼§çº¿ï¼Œ$M_{0}$å’Œ$M_{1}$åˆ†åˆ«å¯¹åº”å¼§çº¿ä¸Šçš„Må’Œ$M^\prime$ ã€‚$M_{0}$Må’Œ$M_{1}M^\prime$çš„é«˜åº¦å·®è®°ä¸º$\Delta \eta$ï¼Œåˆ™$\Delta \eta=f(x_{0}+\Delta x, y_{0}+\Delta y) - f(x_0, y_0)$</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ª$\Delta \eta$ï¼Œ$\Delta \eta&gt;0$ç›¸å½“äºæ²¿ç€è¿™ä¸ªæ›²é¢ç”±åœ°åŠ¿ä½çš„åœ°æ–¹å¾€åœ°åŠ¿é«˜çš„åœ°æ–¹èµ°ï¼Œå°±åƒå›¾ä¸­çš„æ²¿ç€æ›²é¢ä»Mç‚¹èµ°åˆ°$M^\prime$è¿™ä¸ªç‚¹ã€‚åè¿‡æ¥ï¼Œè‹¥$\Delta \eta&lt;0$ç›¸å½“äºæ²¿ç€è¿™ä¸ªæ›²é¢ä»åœ°åŠ¿é«˜çš„åœ°æ–¹å¾€åœ°åŠ¿ä½çš„åœ°æ–¹èµ°ï¼Œå°±å¥½æ¯”ä»$M^\prime$èµ°å‘Mã€‚</p>
<p>æˆ‘ä»¬å†çœ‹çœ‹$\lim_{\rho-&gt;0}{\frac{\Delta \eta}{\rho}}$ï¼Œè¿™ä¸ªæŒ‡æ ‡åæ˜ ä»åœ°åŠ¿é«˜å¾€åœ°åŠ¿ä½æˆ–åœ°åŠ¿ä½å¾€åœ°åŠ¿é«˜æ–¹å‘ä¸Šç§»åŠ¨çš„æ•ˆç‡ï¼Œå¦‚æœè¿™ä¸ªå€¼è¶Šå¤§ï¼Œè¡¨ç¤ºè¿™ä¸ªåœ°æ–¹(æ›²é¢ä¸Šè¿™æå°å—åŒºåŸŸ)è¶Šé™¡å³­ã€‚å¦‚æœ$\lim_{\rho-&gt;0}{\frac{\Delta \eta}{\rho}}$å­˜åœ¨ï¼Œç§°æ­¤æé™ä¸º$\eta=f(x, y)$åœ¨$M_{0}$å¤„æ²¿å°„çº¿Lçš„æ–¹å‘å¯¼æ•°ã€‚è®°ä¸º$\frac{\partial \eta}{\partial L}|_{M_{0}}$ </p>
<p>å³$\frac{\partial \eta}{\partial L}|_{M_{0}}=\lim_{\rho-&gt;0}{\frac{\Delta \eta}{\rho}} æˆ– \frac{\partial \eta}{\partial L}|_{M_{0}}=\lim_{\rho-&gt;0}{\frac{f(x_{0}+\Delta x, y_{0}+\Delta y) - f(x_0, y_0)}{\rho}}$</p>
<h3 id="è®¡ç®—å…¬å¼"><a href="#è®¡ç®—å…¬å¼" class="headerlink" title="è®¡ç®—å…¬å¼"></a>è®¡ç®—å…¬å¼</h3><h5 id="2-dims"><a href="#2-dims" class="headerlink" title="2-dims"></a>2-dims</h5><p> $\zeta = f(x, y)ï¼Œ((x, y)\in D)ï¼ŒM_{0}\in D$ è¿‡ $M_{0}$ä½œå°„çº¿Lï¼Œè®¾Lçš„æ–¹å‘è§’ä¸º$\alpha å’Œ \beta$ï¼ˆæ–¹å‘è§’çš„å®šä¹‰å¦‚ä¸‹å›¾ï¼‰ï¼Œåˆ™</p>
<p>$\frac{\partial \zeta}{\partial L}|_{M_{0}} = \frac{\partial \zeta}{\partial x} \cos{\alpha} + \frac{\partial \zeta}{\partial y} \cos{\beta}$ï¼Œå…¶ä¸­$\frac{\partial \zeta}{\partial x}$è¡¨ç¤º$\zeta$å¯¹xçš„åå¯¼ï¼Œ$\frac{\partial \zeta}{\partial y}$è¡¨ç¤º$\zeta$å¯¹yçš„åå¯¼ã€‚</p>
<p><img src="https://img.heshipeng.com/202205072326064.jpeg?" alt="WechatIMG101" style="zoom:20%; align: middle;" /></p>
<h5 id="3-dims"><a href="#3-dims" class="headerlink" title="3-dims"></a>3-dims</h5><p>$u(x, y, z)$ åœ¨ $M_0(x_0, y_0, z_0)$ å¯å¾®ï¼Œè¿‡ $M_0$ ä½œå°„çº¿Lï¼ŒLçš„æ–¹å‘è§’ä¸º $\alpha \beta \gammaï¼Œ$ åˆ™ $\frac{\partial u}{\partial L}|_{M_0}=\frac{\partial u}{\partial x}|_{M_0}\cos \alpha + \frac{\partial u}{\partial y}|_{M_0}\cos \beta + \frac{\partial u}{\partial z}|_{M_0}\cos \gamma$        </p>
<p>ä¾‹. æ±‚ $\zeta = xe^{2y}åœ¨M_0(1, 0)æ²¿ä»M_0(1, 0)åˆ°M(2, -1)çš„æ–¹å‘å¯¼æ•°$</p>
<p>è§£ï¼š$\frac{\partial \zeta}{\partial x}|_{M_0} = 1, \frac{\partial \zeta}{\partial y}|_{M_0} = 2 $</p>
<p>$\vec{M_0M} = \{1, -1\}, \cos\alpha = \frac{1}{\sqrt{2}}, \cos\beta = \frac{-1}{\sqrt{2}} $</p>
<p>$\frac{\partial \zeta}{\partial L}|M_0 = 1 \cdot \frac{1}{\sqrt{2}} + 2 \cdot (-\frac{1}{\sqrt{2}})$</p>
<h2 id="æ¢¯åº¦"><a href="#æ¢¯åº¦" class="headerlink" title="æ¢¯åº¦"></a>æ¢¯åº¦</h2><h3 id="æ¢¯åº¦çš„å®šä¹‰"><a href="#æ¢¯åº¦çš„å®šä¹‰" class="headerlink" title="æ¢¯åº¦çš„å®šä¹‰"></a>æ¢¯åº¦çš„å®šä¹‰</h3><p>$u=f(x, y, z)ï¼ŒM_0(x_0, y_0, z_0)\in \Omega $ è¿‡ $M_0$ ä½œå°„çº¿Lï¼Œäº§ç”Ÿæ–¹å‘è§’ $\alpha$ $\beta$ $\gamma$ ã€‚åˆ™ï¼š</p>
<p>$\frac{\partial u}{\partial L}|M_0 = \frac{\partial u}{\partial x}|M_0\cos \alpha + \frac{\partial u}{\partial y}|M_0\cos \beta + \frac{\partial u}{\partial z}|M_0\cos \gamma$  </p>
<p>= $\{\frac{\partial u}{\partial x}, \frac{\partial u}{\partial y}, \frac{\partial u}{\partial z}\} \cdot \{\cos\alpha, \cos\beta, \cos\gamma\}$</p>
<p>å‘é‡ $\{\frac{\partial u}{\partial x}, \frac{\partial u}{\partial y}, \frac{\partial u}{\partial z}\}$ æ˜¯ä¸€ä¸ªå¸¸å‘é‡(å›ºå®šä½ç½®ï¼Œç»™å®šäº†M_0çš„åæ ‡ï¼Œè¿™ä¸ªå‘é‡å°±æ˜¯ä¸€ä¸ªç¡®å®šå‘é‡)</p>
<p>å‘é‡ $\{\cos\alpha, \cos\beta, \cos\gamma\}$ æ˜¯ä¸€ä¸ªå•ä½å‘é‡(ä¸LåŒå‘ï¼Œ<strong>ä»»ä½•ä¸€ä¸ªå‘é‡ï¼Œå®ƒçš„æ–¹å‘ä½™å¼¦æ„æˆçš„å‘é‡ï¼Œå°±æ˜¯è¯¥å‘é‡çš„å•ä½å‘é‡ï¼Œæ–¹å‘ä¸è¯¥å‘é‡ç›¸åŒï¼Œå•ä½æ˜¯1</strong>)</p>
<p><img src="https://img.heshipeng.com/202205081142190.jpeg" alt="WechatIMG102" style="zoom:20%;" /></p>
<p> $\frac{\partial u}{\partial L}|M_0 = \{\frac{\partial u}{\partial x}, \frac{\partial u}{\partial y}, \frac{\partial u}{\partial z}\}  \vec{e} = \sqrt{(\frac{\partial u}{\partial x})^2 + (\frac{\partial u}{\partial y})^2 + (\frac{\partial u}{\partial z})^2}  \cos\theta$ </p>
<p>$\sqrt{(\frac{\partial u}{\partial x})^2 + (\frac{\partial u}{\partial y})^2 + (\frac{\partial u}{\partial z})^2}$æ˜¯ä¸€ä¸ªå›ºå®šçš„æ•°ï¼Œå½“ $\cos\theta = 1$ å³ $\theta=0$æ—¶ï¼Œ$\frac{\partial u}{\partial L}|M_0$å–æœ€å¤§å€¼</p>
<p>é‚£ä¹ˆï¼Œ$u=f(x, y)$ åœ¨ $M_0$ çš„æ¢¯åº¦å³ $grad \ u|M_0$ = $\{\frac{\partial u}{\partial x}, \frac{\partial u}{\partial y}, \frac{\partial u}{\partial z}\}|M_0$ ã€‚ä¸€èˆ¬åœ°ï¼Œ$grad \ u = \{\frac{\partial u}{\partial x}, \frac{\partial u}{\partial y}, \frac{\partial u}{\partial z}\}$</p>
<p>æ¢¯åº¦çš„æ–¹å‘ï¼Œå³å‡½æ•°å¢é•¿é€Ÿåº¦æœ€å¿«çš„æ–¹å‘ï¼Œæˆ–è€…æ–¹å‘å¯¼æ•°å–æœ€å¤§å€¼çš„æ–¹å‘ã€‚</p>
<h3 id="ä¸æ–¹å‘å¯¼æ•°çš„å…³ç³»"><a href="#ä¸æ–¹å‘å¯¼æ•°çš„å…³ç³»" class="headerlink" title="ä¸æ–¹å‘å¯¼æ•°çš„å…³ç³»"></a>ä¸æ–¹å‘å¯¼æ•°çš„å…³ç³»</h3><p>å‡½æ•° $\zeta$ åœ¨ $M_0$ æ²¿ç€ä¸åŒçš„å°„çº¿å¯ä»¥å¾—åˆ°ä¸åŒçš„æ–¹å‘å¯¼æ•°ï¼Œæ¢¯åº¦åˆ™æ˜¯è¿‡ $M_0$ ç‚¹æ‰€æœ‰è¿™äº›æ–¹å‘å¯¼æ•°å–æœ€å¤§å€¼æ—¶é‚£ä¸ªå°„çº¿çš„æ–¹å‘ã€‚</p>
<p>ç”¨ä¸€ä¸ªåŠ¨ç”»å±•ç¤ºäºŒè€…çš„å…³ç³»ï¼š</p>
<div align="middle">
   <iframe src="//player.bilibili.com/player.html?aid=19844108&bvid=BV1sW411775X&cid=32363257&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="50%"> </iframe>
</div>



<h3 id="æ¢¯åº¦çš„è®¡ç®—"><a href="#æ¢¯åº¦çš„è®¡ç®—" class="headerlink" title="æ¢¯åº¦çš„è®¡ç®—"></a>æ¢¯åº¦çš„è®¡ç®—</h3><p>è®¾ $u=xyz+z^2+5$ï¼Œ æ±‚ $grad \ u$ï¼Œå¹¶æ±‚åœ¨ç‚¹M(0, 1, -1)å¤„çš„æ–¹å‘å¯¼æ•°çš„æœ€å¤§(å°)å€¼ã€‚</p>
<p>è§£ï¼š$\because \frac{\partial u}{\partial x} = yz, \frac{\partial u}{\partial y} = xz, \frac{\partial u}{\partial z} = xy + 2z $</p>
<p>$\therefore grad \ u|_{(0, 1, -1)} = (yz, xz, xy+2z)|_{(0, 1, -1)} = (-1, 0, -2) $</p>
<p>ä»è€Œ $max\{\frac{\partial u}{\partial L}|_M\} = ||grad \ u|| = \sqrt{5}, min\{\frac{\partial u}{\partial L}|_M\} = -||grad \ u|| = -\sqrt{5}$</p>

    

        <a href="/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94%E6%96%B9%E5%90%91%E5%AF%BC%E6%95%B0%E4%B8%8E%E6%A2%AF%E5%BA%A6/" class="post-more waves-effect waves-button">
            Continue reading...
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E5%AD%A6/" rel="tag">æ•°å­¦</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">æ·±åº¦å­¦ä¹ </a></li></ul>

    </div>
    
</article>

        </li>
    
    </ul>

    
<nav id="page-nav">
    <div class="inner">
    <a class="extend prev" rel="prev" href="/page/3/">ä¸Šä¸€é¡µ</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
    </div>
</nav>


</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        ç«™ç‚¹æ€»è®¿å®¢æ•°ï¼š<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        ç«™ç‚¹æ€»è®¿é—®é‡ï¼š<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>æ‹¾å…‰çš„ç¢ç¾½ &copy; 2021 - 2022</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">é„‚ICPå¤‡2022001140å·</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.heshipeng.com/page/4/&title=Hexo&pic=https://img.heshipeng.com/202205092042366.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.heshipeng.com/page/4/&title=Hexo&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.heshipeng.com/page/4/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=Hexo&url=https://blog.heshipeng.com/page/4/&via=https://blog.heshipeng.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.heshipeng.com/page/4/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://blog.heshipeng.com/page/4/" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.js?v=1.7.2" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'æ­»é¬¼å»å“ªé‡Œäº†ï¼';
            clearTimeout(titleTime);
        } else {
            document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
