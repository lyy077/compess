<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Androidé€†å‘ä¹‹åŠ¨æ€åŠ è½½ | ä½•ä»•é¹çš„ä¸ªäººåšå®¢ | healthy,weathy,freedom,lucky,happy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="é€†å‘,android">
    <meta name="description" content="åŠ¨æ€åŠ è½½å¼€å§‹æ­£é¢˜ä¹‹å‰ï¼Œåœ¨è¿™é‡Œå¯ä»¥å…ˆç»™åŠ¨æ€åŠ è½½æŠ€æœ¯åšä¸€ä¸ªç®€å•çš„å®šä¹‰ã€‚çœŸæ­£çš„åŠ¨æ€åŠ è½½åº”è¯¥æ˜¯  åº”ç”¨åœ¨è¿è¡Œçš„æ—¶å€™é€šè¿‡åŠ è½½ä¸€äº›æœ¬åœ°ä¸å­˜åœ¨çš„å¯æ‰§è¡Œæ–‡ä»¶å®ç°ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ã€‚ è¿™äº›å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¯ä»¥æ›¿æ¢çš„ã€‚ æ›´æ¢é™æ€èµ„æº(æ¯”å¦‚æ¢å¯åŠ¨å›¾ã€æ¢ä¸»é¢˜ã€æˆ–è€…ç”¨æœåŠ¡å™¨å‚æ•°å¼€å…³æ§åˆ¶å¹¿å‘Šçš„éšè—ç°å®ç­‰)ä¸å±äºåŠ¨æ€åŠ è½½ã€‚ Androidä¸­åŠ¨æ€åŠ è½½çš„æ ¸å¿ƒæ€æƒ³æ˜¯åŠ¨æ€è°ƒç”¨å¤–éƒ¨çš„ dexæ–‡ä»¶ï¼Œæç«¯çš„æƒ…å†µä¸‹ï¼ŒAndroid APKè‡ªèº«">
<meta property="og:type" content="article">
<meta property="og:title" content="Androidé€†å‘ä¹‹åŠ¨æ€åŠ è½½">
<meta property="og:url" content="https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/index.html">
<meta property="og:site_name" content="ä½•ä»•é¹çš„ä¸ªäººåšå®¢">
<meta property="og:description" content="åŠ¨æ€åŠ è½½å¼€å§‹æ­£é¢˜ä¹‹å‰ï¼Œåœ¨è¿™é‡Œå¯ä»¥å…ˆç»™åŠ¨æ€åŠ è½½æŠ€æœ¯åšä¸€ä¸ªç®€å•çš„å®šä¹‰ã€‚çœŸæ­£çš„åŠ¨æ€åŠ è½½åº”è¯¥æ˜¯  åº”ç”¨åœ¨è¿è¡Œçš„æ—¶å€™é€šè¿‡åŠ è½½ä¸€äº›æœ¬åœ°ä¸å­˜åœ¨çš„å¯æ‰§è¡Œæ–‡ä»¶å®ç°ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ã€‚ è¿™äº›å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¯ä»¥æ›¿æ¢çš„ã€‚ æ›´æ¢é™æ€èµ„æº(æ¯”å¦‚æ¢å¯åŠ¨å›¾ã€æ¢ä¸»é¢˜ã€æˆ–è€…ç”¨æœåŠ¡å™¨å‚æ•°å¼€å…³æ§åˆ¶å¹¿å‘Šçš„éšè—ç°å®ç­‰)ä¸å±äºåŠ¨æ€åŠ è½½ã€‚ Androidä¸­åŠ¨æ€åŠ è½½çš„æ ¸å¿ƒæ€æƒ³æ˜¯åŠ¨æ€è°ƒç”¨å¤–éƒ¨çš„ dexæ–‡ä»¶ï¼Œæç«¯çš„æƒ…å†µä¸‹ï¼ŒAndroid APKè‡ªèº«">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.heshipeng.com/202201131046618.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="og:image" content="https://img.heshipeng.com/202201131057328.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="og:image" content="https://img.heshipeng.com/202201131124371.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="og:image" content="https://img.heshipeng.com/202201131142562.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="og:image" content="https://img.heshipeng.com/202201131058935.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="og:image" content="https://img.heshipeng.com/202201131409909.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="og:image" content="https://img.heshipeng.com/202201131612910.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="og:image" content="https://img.heshipeng.com/202201152137281.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="og:image" content="https://img.heshipeng.com/202201152139770.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="og:image" content="https://img.heshipeng.com/202201152147745.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="og:image" content="https://img.heshipeng.com/202201152315708.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
<meta property="article:published_time" content="2022-01-15T15:40:22.000Z">
<meta property="article:modified_time" content="2022-03-03T02:16:58.820Z">
<meta property="article:author" content="æ‹¾å…‰çš„ç¢ç¾½">
<meta property="article:tag" content="é€†å‘">
<meta property="article:tag" content="android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.heshipeng.com/202201131046618.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300">
    
        <link rel="alternate" type="application/atom+xml" title="ä½•ä»•é¹çš„ä¸ªäººåšå®¢" href="/atom.xml">
    
    <link rel="shortcut icon" href="https://img.heshipeng.com/202205092054351.png">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(https://img.heshipeng.com/202205092044923.jpeg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://img.heshipeng.com/202205092042366.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">æ‹¾å…‰çš„ç¢ç¾½</h5>
          <a href="mailto:1615433864@qq.com" title="1615433864@qq.com" class="mail">1615433864@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/atom.xml" target="_blank" >
                <i class="icon icon-lg icon-feed"></i>
                RSS
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Androidé€†å‘ä¹‹åŠ¨æ€åŠ è½½</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Androidé€†å‘ä¹‹åŠ¨æ€åŠ è½½</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-01-15T15:40:22.000Z" itemprop="datePublished" class="page-time">
  2022-01-15
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD"><span class="post-toc-number">1.</span> <span class="post-toc-text">åŠ¨æ€åŠ è½½</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%B8%A4%E4%B8%AA%E7%96%91%E9%97%AE%F0%9F%A4%94"><span class="post-toc-number">2.</span> <span class="post-toc-text">ä¸¤ä¸ªç–‘é—®ğŸ¤”</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E4%B8%8E%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE"><span class="post-toc-number">3.</span> <span class="post-toc-text">ç±»åŠ è½½å™¨ä¸åŒäº²å§”æ´¾</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">ç±»åŠ è½½å™¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#JVM%E7%9A%84%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">JVMçš„ç±»åŠ è½½å™¨</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Android%E4%B8%AD%E7%9A%84%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="post-toc-number">3.1.2.</span> <span class="post-toc-text">Androidä¸­çš„ç±»åŠ è½½å™¨</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%97%B6%E6%9C%BA"><span class="post-toc-number">3.1.3.</span> <span class="post-toc-text">ç±»åŠ è½½çš„æ—¶æœº</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="post-toc-number">3.1.4.</span> <span class="post-toc-text">ç±»åŠ è½½çš„æ­¥éª¤</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%E6%B5%8B%E8%AF%95Android-ClassLoader%E7%9A%84%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="post-toc-number">3.1.5.</span> <span class="post-toc-text">ç¼–å†™ä»£ç æµ‹è¯•Android ClassLoaderçš„ç»§æ‰¿å…³ç³»</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">åŒäº²å§”æ´¾</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">åŒäº²å§”æ´¾çš„å·¥ä½œåŸç†</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E6%9C%89%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE"><span class="post-toc-number">3.2.2.</span> <span class="post-toc-text">ä¸ºä»€ä¹ˆä¼šæœ‰åŒäº²å§”æ´¾</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%A7%A3%E5%86%B3%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98"><span class="post-toc-number">4.</span> <span class="post-toc-text">è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%A7%A3%E5%86%B3%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%97%AE%E9%A2%98"><span class="post-toc-number">5.</span> <span class="post-toc-text">è§£å†³ç¬¬äºŒä¸ªé—®é¢˜</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9A%E6%9B%BF%E6%8D%A2mClassLoader%E4%B8%BADexClassLoader"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">æ–¹æ¡ˆä¸€ï¼šæ›¿æ¢mClassLoaderä¸ºDexClassLoader</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9A%E5%9C%A8mClassLoader%E5%92%8CBootClassLoader%E4%B9%8B%E9%97%B4%E6%8F%92%E5%85%A5DexClassLoader"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">æ–¹æ¡ˆäºŒï¼šåœ¨mClassLoaderå’ŒBootClassLoaderä¹‹é—´æ’å…¥DexClassLoader</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93"><span class="post-toc-number">6.</span> <span class="post-toc-text">æ€»ç»“</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="post-toc-number">7.</span> <span class="post-toc-text">å‚è€ƒé“¾æ¥</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Androidé€†å‘ä¹‹åŠ¨æ€åŠ è½½"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Androidé€†å‘ä¹‹åŠ¨æ€åŠ è½½</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-01-15 23:40:22" datetime="2022-01-15T15:40:22.000Z"  itemprop="datePublished">2022-01-15</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="æ–‡ç« æ€»é˜…è¯»é‡" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <div align="middle"><iframe width="560" height="315" src="https://www.youtube.com/embed/k7akz2hdToY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>



<h3 id="åŠ¨æ€åŠ è½½"><a href="#åŠ¨æ€åŠ è½½" class="headerlink" title="åŠ¨æ€åŠ è½½"></a>åŠ¨æ€åŠ è½½</h3><p>å¼€å§‹æ­£é¢˜ä¹‹å‰ï¼Œåœ¨è¿™é‡Œå¯ä»¥å…ˆç»™åŠ¨æ€åŠ è½½æŠ€æœ¯åšä¸€ä¸ªç®€å•çš„å®šä¹‰ã€‚çœŸæ­£çš„åŠ¨æ€åŠ è½½åº”è¯¥æ˜¯</p>
<ol>
<li>åº”ç”¨åœ¨è¿è¡Œçš„æ—¶å€™é€šè¿‡åŠ è½½ä¸€äº›<strong>æœ¬åœ°ä¸å­˜åœ¨</strong>çš„å¯æ‰§è¡Œæ–‡ä»¶å®ç°ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ã€‚</li>
<li>è¿™äº›å¯æ‰§è¡Œæ–‡ä»¶æ˜¯<strong>å¯ä»¥æ›¿æ¢</strong>çš„ã€‚</li>
<li>æ›´æ¢é™æ€èµ„æº(æ¯”å¦‚æ¢å¯åŠ¨å›¾ã€æ¢ä¸»é¢˜ã€æˆ–è€…ç”¨æœåŠ¡å™¨å‚æ•°å¼€å…³æ§åˆ¶å¹¿å‘Šçš„éšè—ç°å®ç­‰)<strong>ä¸å±äº</strong>åŠ¨æ€åŠ è½½ã€‚</li>
<li><code>Android</code>ä¸­åŠ¨æ€åŠ è½½çš„æ ¸å¿ƒæ€æƒ³æ˜¯åŠ¨æ€è°ƒç”¨å¤–éƒ¨çš„ <strong><code>dex</code>æ–‡ä»¶</strong>ï¼Œæç«¯çš„æƒ…å†µä¸‹ï¼Œ<code>Android APK</code>è‡ªèº«å¸¦æœ‰çš„<code>Dex</code>æ–‡ä»¶åªæ˜¯ä¸€ä¸ªç¨‹åºçš„å…¥å£(æˆ–è€…è¯´ç©ºå£³)ï¼Œæ‰€æœ‰çš„åŠŸèƒ½éƒ½é€šè¿‡ä»æœåŠ¡å™¨ä¸‹è½½æœ€æ–°çš„<code>Dex</code>æ–‡ä»¶å®Œæˆã€‚</li>
</ol>
<h3 id="ä¸¤ä¸ªç–‘é—®ğŸ¤”"><a href="#ä¸¤ä¸ªç–‘é—®ğŸ¤”" class="headerlink" title="ä¸¤ä¸ªç–‘é—®ğŸ¤”"></a>ä¸¤ä¸ªç–‘é—®ğŸ¤”</h3><p>æå‡ºä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ï¼Œå¦‚ä½•åœ¨<code>Android</code>ç¨‹åºä¸­åŠ è½½å¤–éƒ¨<code>dex</code>çš„<code>class</code>ï¼›ç¬¬äºŒï¼Œå¯¹äºæœ‰ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶(æ¯”å¦‚Activityè¿™ç§ç±»)è¯¥å¦‚ä½•åŠ è½½ï¼Ÿæœ¬æ–‡çš„ç›®çš„å°±æ˜¯é€šè¿‡è§£å†³è¿™2ä¸ªé—®é¢˜ä»è€Œå¯¹<code>Android</code>çš„åŠ¨æ€åŠ è½½æŠ€æœ¯æœ‰ä¸€å®šçš„äº†è§£ã€‚</p>
<h3 id="ç±»åŠ è½½å™¨ä¸åŒäº²å§”æ´¾"><a href="#ç±»åŠ è½½å™¨ä¸åŒäº²å§”æ´¾" class="headerlink" title="ç±»åŠ è½½å™¨ä¸åŒäº²å§”æ´¾"></a>ç±»åŠ è½½å™¨ä¸åŒäº²å§”æ´¾</h3><p>è¦è§£å†³è¿™ä¿©é—®é¢˜ï¼Œé¦–å…ˆè¦äº†è§£å‡ ä¸ªæ¦‚å¿µã€‚</p>
<h4 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h4><p>ç±»åŠ è½½å™¨é¡¾åæ€ä¹‰æ˜¯ç”¨æ¥è¿›è¡Œç±»çš„åŠ è½½ã€‚åˆ†åˆ«çœ‹ä¸‹JVMçš„ç±»åŠ è½½å™¨å’ŒAndroidçš„ç±»åŠ è½½å™¨ã€‚</p>
<h5 id="JVMçš„ç±»åŠ è½½å™¨"><a href="#JVMçš„ç±»åŠ è½½å™¨" class="headerlink" title="JVMçš„ç±»åŠ è½½å™¨"></a>JVMçš„ç±»åŠ è½½å™¨</h5><p>JVMçš„ç±»åŠ è½½å™¨åŒ…æ‹¬3ç§ï¼š</p>
<ol>
<li>Bootstrap ClassLoader(å¼•å¯¼ç±»åŠ è½½å™¨)</li>
</ol>
<p>C/C++ä»£ç å®ç°çš„åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½æŒ‡å®šçš„JDKçš„æ ¸å¿ƒç±»åº“ï¼Œæ¯”å¦‚java.langï¼Œjava.utilç­‰è¿™äº›ç³»ç»Ÿç±»ã€‚Javaè™šæ‹Ÿæœºçš„å¯åŠ¨å°±æ˜¯é€šè¿‡Bootstrapï¼Œè¯¥Classloaderåœ¨javaé‡Œæ— æ³•è·å–ï¼Œè´Ÿè´£åŠ è½½/libä¸‹çš„ç±»ã€‚</p>
<ol>
<li>Extensions ClassLoader(æ‹“å±•ç±»åŠ è½½å™¨)</li>
</ol>
<p>Javaä¸­çš„å®ç°ç±»ä¸ºExtClassLoaderï¼Œæä¾›äº†é™¤äº†ç³»ç»Ÿç±»ä¹‹å¤–çš„é¢å¤–åŠŸèƒ½ï¼Œå¯ä»¥åœ¨Javaé‡Œè·å–ï¼Œè´Ÿè´£åŠ è½½/lib/extä¸‹çš„ç±»ã€‚</p>
<ol>
<li>Application ClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)</li>
</ol>
<p>Javaä¸­çš„å®ç°ç±»ä¸ºAppClassLoaderï¼Œæ˜¯ä¸æˆ‘ä»¬æ¥è§¦æœ€å¤šçš„ç±»åŠ è½½å™¨ï¼Œå¼€å‘äººå‘˜å†™çš„ä»£ç é»˜è®¤å°±æ˜¯ç”±å®ƒæ¥åŠ è½½ï¼ŒClassLoader.getSystemCLassLoaderè¿”å›çš„å°±æ˜¯å®ƒã€‚</p>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œåªéœ€è¦é€šè¿‡ç»§æ‰¿java.lang.ClassLoaderç±»çš„æ–¹å¼æ¥å®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨å³å¯ã€‚</p>
<h5 id="Androidä¸­çš„ç±»åŠ è½½å™¨"><a href="#Androidä¸­çš„ç±»åŠ è½½å™¨" class="headerlink" title="Androidä¸­çš„ç±»åŠ è½½å™¨"></a>Androidä¸­çš„ç±»åŠ è½½å™¨</h5><p>é¦–å…ˆé€šè¿‡ä¸€å¼ å›¾ï¼Œäº†è§£å„ä¸ªåŠ è½½å™¨ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131046618.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image" title="">
                </div>
                <div class="image-caption">image</div>
            </figure>
<p>è¯¦ç»†çœ‹ä¸‹å„ä¸ªç±»åŠ è½½å™¨çš„ä½œç”¨ï¼š</p>
<ol>
<li>ClassLoaderä¸ºæŠ½è±¡ç±»ï¼›</li>
<li>BootClassLoaderé¢„åŠ è½½å¸¸ç”¨ç±»ï¼Œå•ä¾‹æ¨¡å¼ã€‚ä¸Javaä¸­çš„BootClassLoaderä¸åŒï¼Œå®ƒå¹¶ä¸æ˜¯ç”±C/C++ä»£ç å®ç°ï¼Œè€Œæ˜¯ç”±Javaå®ç°çš„ï¼›</li>
<li>BaseDexClassLoaderæ˜¯PathClassLoader, DexClassLoader, InMemoryDexClassLoaderçš„çˆ¶ç±»ï¼Œç±»åŠ è½½çš„ä¸»è¦é€»è¾‘éƒ½æ˜¯åœ¨BaseDexClassLoaderå®Œæˆçš„ï¼›</li>
<li><p>SecureClassLoaderç»§æ‰¿äº†æŠ½è±¡ç±»ClassLoaderï¼Œæ‹“å±•äº†ClassLoaderç±»åŠ å…¥äº†æƒé™æ–¹é¢çš„åŠŸèƒ½ï¼ŒåŠ å¼ºäº†å®‰å…¨æ€§ï¼Œå…¶å­ç±»URLClassLoaderæ˜¯ç”¨URLè·¯å¾„ä»jaræ–‡ä»¶ä¸­åŠ è½½ç±»å’Œèµ„æºã€‚</p>
</li>
<li><p>PathClassLoaderæ˜¯Androidé»˜è®¤ä½¿ç”¨çš„ç±»åŠ è½½å™¨ï¼Œä¸€ä¸ªapkä¸­çš„Activityç­‰ç±»ä¾¿æ˜¯åœ¨å…¶ä¸­åŠ è½½ã€‚</p>
</li>
<li><p>DexClassLoaderå¯ä»¥åŠ è½½ä»»æ„ç›®å½•ä¸‹çš„dex/jar/apk/zipæ–‡ä»¶ï¼Œæ¯”PathClassLoaderæ›´çµæ´»ï¼Œæ˜¯å®ç°æ’ä»¶åŒ–ï¼Œçƒ­ä¿®å¤ä»¥åŠdexåŠ å£³çš„é‡ç‚¹ã€‚</p>
</li>
<li><p>InMemoryDexClassLoaderæ˜¯8.0å¼•å…¥çš„ï¼Œæ˜¯ç”¨äºç›´æ¥ä»å†…å­˜ä¸­åŠ è½½dexã€‚</p>
</li>
</ol>
<p>å…¶ä¸­é‡ç‚¹å…³æ³¨çš„æ˜¯ï¼šPathClassLoaderå’ŒDexClassLoaderï¼Œå› ä¸ºè¿™2ä¸ªç±»åŠ è½½å™¨æ˜¯æˆ‘ä»¬è§£å†³ä¸Šé¢2ä¸ªé—®é¢˜çš„å…³é”®ï¼Œä¹Ÿæ˜¯è¿™ä¸ªåŠ¨æ€åŠ è½½ä¸­éå¸¸é‡è¦çš„çš„ç±»åŠ è½½å™¨ã€‚</p>
<h5 id="ç±»åŠ è½½çš„æ—¶æœº"><a href="#ç±»åŠ è½½çš„æ—¶æœº" class="headerlink" title="ç±»åŠ è½½çš„æ—¶æœº"></a>ç±»åŠ è½½çš„æ—¶æœº</h5><ol>
<li>éšå¼åŠ è½½ã€‚</li>
</ol>
<ul>
<li>åˆ›å»ºç±»çš„å®ä¾‹ã€‚</li>
<li>è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œæˆ–è€…ä¸ºé™æ€å˜é‡èµ‹å€¼ã€‚</li>
<li>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ã€‚</li>
<li>ä½¿ç”¨åå°„æ–¹å¼æ¥å¼ºåˆ¶åˆ›å»ºæŸä¸ªç±»æˆ–è€…æ¥å£å¯¹åº”çš„java.lang.Classå¯¹è±¡ã€‚</li>
</ul>
<ol>
<li>æ˜¾å¼åŠ è½½ã€‚</li>
</ol>
<ul>
<li>ä½¿ç”¨LoadClass()åŠ è½½ã€‚</li>
<li>ä½¿ç”¨forName()åŠ è½½ã€‚</li>
</ul>
<h5 id="ç±»åŠ è½½çš„æ­¥éª¤"><a href="#ç±»åŠ è½½çš„æ­¥éª¤" class="headerlink" title="ç±»åŠ è½½çš„æ­¥éª¤"></a>ç±»åŠ è½½çš„æ­¥éª¤</h5><ol>
<li><p>è£…è½½ã€‚æŸ¥æ‰¾å’Œå¯¼å…¥Classæ–‡ä»¶ã€‚</p>
</li>
<li><p>é“¾æ¥ã€‚å…¶ä¸­è§£ææ­¥éª¤æ˜¯å¯ä»¥é€‰æ‹©çš„ã€‚</p>
</li>
<li><ul>
<li>æ£€æŸ¥ï¼šæ£€æŸ¥è½½å…¥çš„classæ–‡ä»¶æ•°æ®çš„æ­£ç¡®æ€§ã€‚</li>
<li>å‡†å¤‡ï¼šç»™ç±»çš„é™æ€å˜é‡åˆ†é…å­˜å‚¨ç©ºé—´ã€‚</li>
<li>è§£æï¼šå°†ç¬¦å·å¼•ç”¨è½¬æ¢æˆç›´æ¥å¼•ç”¨ã€‚</li>
</ul>
</li>
<li><p>åˆå§‹åŒ–ï¼šå³è°ƒç”¨<clinit>å‡½æ•°ï¼Œå¯¹é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</p>
</li>
</ol>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131057328.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image" title="">
                </div>
                <div class="image-caption">image</div>
            </figure>
<h5 id="ç¼–å†™ä»£ç æµ‹è¯•Android-ClassLoaderçš„ç»§æ‰¿å…³ç³»"><a href="#ç¼–å†™ä»£ç æµ‹è¯•Android-ClassLoaderçš„ç»§æ‰¿å…³ç³»" class="headerlink" title="ç¼–å†™ä»£ç æµ‹è¯•Android ClassLoaderçš„ç»§æ‰¿å…³ç³»"></a>ç¼–å†™ä»£ç æµ‹è¯•Android ClassLoaderçš„ç»§æ‰¿å…³ç³»</h5><p>åŠ¨æ‰‹ä¹‹å‰å…ˆé€šè¿‡<a target="_blank" rel="noopener" href="http://androidxref.com">Androidæºç é˜…è¯»ç½‘ç«™</a>ï¼Œçœ‹ä¸‹ClassLoaderçš„æºç ï¼š</p>
<p><img src="https://img.heshipeng.com/202201131124371.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="android ClassLoaderç±»æºç "></p>
<p>æ‰“å¼€AndroidXRefï¼ŒDefinitionå¡«å†™<code>ClassLoader</code>ï¼Œæœç´¢åŒ…ä½ç½®<code>libcore</code>ï¼Œå¦‚æœä¸ç¡®å®šä½ç½®ï¼Œå¯ä»¥é€‰ä¸­å…¨éƒ¨ï¼Œåªä¸è¿‡æœç´¢å‡ºæ¥çš„ç»“æœä¸æ¯”è¾ƒå¤šï¼Œç­›é€‰èµ·æ¥éº»çƒ¦ä¸€äº›ã€‚æœç´¢å‡ºæ¥ä¸€ä¸ªClassLoader.javaæ–‡ä»¶ï¼Œç‚¹å‡»è¿›å…¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">    <span class="comment">// çœç•¥</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// The parent class loader for delegation</span></span><br><span class="line">    <span class="comment">// Note: VM hardcoded the offset of this field, thus all new fields</span></span><br><span class="line">    <span class="comment">// must be added *after* it.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClassLoader parent;</span><br><span class="line">  </span><br><span class="line">  	<span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ClassLoader <span class="title">getParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çœç•¥ </span></span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…³æ³¨ä¸€ä¸ªå±æ€§å’Œä¸€ä¸ªæˆå‘˜æ–¹æ³•ï¼Œé€šè¿‡ç»„åˆå…³ç³»parentæ¥æ ‡è¯†æ¯ä¸€ä¸ªClassLoaderçš„çˆ¶äº²ï¼Œè¿™ä¸ªparentæ˜¯å®ç°åŒäº²å§”æ´¾çš„å…³é”®ï¼Œè°ƒç”¨getParentæˆå‘˜æ–¹æ³•åˆ™å¯ä»¥è·å–åˆ°parentå±æ€§ã€‚</p>
<p>çœ‹äº†è¿™ä¹ˆå¤šç†è®ºï¼Œæ²¡æœ‰åŠ¨æ‰‹codingå»å®è·µï¼Œæœ‰ä¸€ç‚¹æ¯ç‡¥ï¼Œæ¥ä¸‹æ¥ç¼–å†™ä¸€ä¸ªdemoå»æµ‹è¯•ä¸€ä¸‹Androidçš„ClassLoaderä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚</p>
<p>æ–°å»ºä¸€ä¸ªé¡¹ç›®ClassLoaderTestï¼Œç„¶åç¼–ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.classloadertest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        testClassLoader();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testClassLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰çš„ClassLoader</span></span><br><span class="line">        Context context = getApplicationContext();</span><br><span class="line">        ClassLoader thisClassLoader = context.getClassLoader();</span><br><span class="line">        <span class="comment">// æˆ–è€…ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ï¼š</span></span><br><span class="line">        <span class="comment">// ClassLoader thisClassLoader = MainActivity.class.getClassLoader();</span></span><br><span class="line">        Log.i(<span class="string">&quot;kanxue&quot;</span>, <span class="string">&quot;thisClassLoader:&quot;</span> + thisClassLoader);</span><br><span class="line">        ClassLoader tmpClassLoader = <span class="keyword">null</span>;</span><br><span class="line">        ClassLoader parentClassLoader = thisClassLoader.getParent();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘ä¸Šéå†classLoader</span></span><br><span class="line">        <span class="keyword">while</span> (parentClassLoader != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Log.i(<span class="string">&quot;kanxue&quot;</span>, <span class="string">&quot;this:&quot;</span> + thisClassLoader + <span class="string">&quot;, parent:&quot;</span> + parentClassLoader);</span><br><span class="line">            tmpClassLoader = parentClassLoader.getParent();</span><br><span class="line">            thisClassLoader = parentClassLoader;</span><br><span class="line">            parentClassLoader = tmpClassLoader;</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">&quot;kanxue&quot;</span>, <span class="string">&quot;root:&quot;</span> + thisClassLoader);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç›´æ¥ç”¨äº†ä¸Šé¢æºç åˆ†æçš„getParentæ–¹æ³•ï¼Œé€šè¿‡getParentæ–¹æ³•æ‹¿åˆ°parentï¼Œç„¶åä¸€å±‚å±‚çš„å‘ä¸Šéå†ï¼Œä»è€Œæµ‹è¯•å‡ºå„ä¸ªClassLoaderçš„ç»§æ‰¿å…³ç³»ã€‚</p>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131142562.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image" title="">
                </div>
                <div class="image-caption">image</div>
            </figure>
<h4 id="åŒäº²å§”æ´¾"><a href="#åŒäº²å§”æ´¾" class="headerlink" title="åŒäº²å§”æ´¾"></a>åŒäº²å§”æ´¾</h4><h5 id="åŒäº²å§”æ´¾çš„å·¥ä½œåŸç†"><a href="#åŒäº²å§”æ´¾çš„å·¥ä½œåŸç†" class="headerlink" title="åŒäº²å§”æ´¾çš„å·¥ä½œåŸç†"></a>åŒäº²å§”æ´¾çš„å·¥ä½œåŸç†</h5><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³æ¯ä¸ªå„¿å­éƒ½ä¸æ„¿æ„å¹²æ´»ï¼Œæ¯æ¬¡æœ‰æ´»å°±ä¸¢ç»™çˆ¶äº²å»å¹²ï¼Œç›´åˆ°çˆ¶äº²è¯´è¿™ä»¶äº‹ä¹Ÿå¹²ä¸äº†æ—¶ï¼Œå„¿å­è‡ªå·±æƒ³åŠæ³•å»å®Œæˆï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾ã€‚</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131058935.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image" title="">
                </div>
                <div class="image-caption">image</div>
            </figure>
<h5 id="ä¸ºä»€ä¹ˆä¼šæœ‰åŒäº²å§”æ´¾"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰åŒäº²å§”æ´¾" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰åŒäº²å§”æ´¾"></a>ä¸ºä»€ä¹ˆä¼šæœ‰åŒäº²å§”æ´¾</h5><ol>
<li>é¿å…é‡å¤åŠ è½½ï¼Œå¦‚æœå·²ç»åŠ è½½è¿‡ä¸€æ¬¡Classï¼Œå¯ä»¥ç›´æ¥è¯»å–å·²ç»åŠ è½½çš„Class</li>
<li>æ›´åŠ å®Œå…¨ï¼Œæ— æ³•è‡ªå®šä¹‰ç±»æ¥ä»£æ›¿ç³»ç»Ÿçš„ç±»ï¼Œå¯ä»¥é˜²æ­¢æ ¸å¿ƒAPIåº“è¢«éšæ„ç¯¡æ”¹ã€‚</li>
</ol>
<h3 id="è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜"><a href="#è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜" class="headerlink" title="è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜"></a>è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜</h3><p>é€šè¿‡å‰é¢çš„ç†è®ºçŸ¥è¯†ï¼Œæˆ‘ä»¬çŸ¥é“äº†DexClassLoaderå¯ä»¥åŠ è½½ä»»æ„ç›®å½•ä¸‹çš„dex/jar/apk/zipæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>ç”Ÿæˆä¸€ä¸ªç”¨æ¥æµ‹è¯•çš„dexæ–‡ä»¶ã€‚</li>
</ol>
<p>åˆ›å»ºé¡¹ç›®<code>DexLoaderTest</code>ï¼Œç„¶åæ–°å»ºClassï¼š<code>TestCLass</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dexloadertest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">&quot;kanxue&quot;</span>, <span class="string">&quot;call from DexLoaderTest.TestClass.testFunc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯ç®€å•çš„æ‰“å°äº†ä¸€æ¡æ—¥å¿—ã€‚</p>
<p>æ¥ç€ï¼Œæ‰“åŒ…è¯¥é¡¹ç›®ï¼Œå°†ç”Ÿæˆçš„apkè§£å‹ï¼Œå¾—åˆ°dexæ–‡ä»¶(å¦‚æœè§£å‹å¾—åˆ°å¤šä¸ªclasses.dexæ–‡ä»¶ï¼ŒæŸ¥çœ‹ä¸‹æˆ‘ä»¬ç¼–å†™çš„TestClassç±»åœ¨å“ªä¸ªclasses.dexæ–‡ä»¶)ï¼Œç„¶åå°†è¿™ä¸ªclasses.dexæ”¾åˆ°æ‰‹æœºçš„å†…å­˜å¡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push classes.dex /sdcard/</span><br></pre></td></tr></table></figure>
<ol>
<li>åŠ è½½sdcardä¸Šçš„dex</li>
</ol>
<p>ä¿®æ”¹<code>DexLoaderTest</code>ï¼Œä¿®æ”¹å…¶<code>MainActivity</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dexloadertest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dalvik.system.DexClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        String sdcardPath = Environment.getExternalStorageDirectory().getAbsolutePath();</span><br><span class="line">        dexClassLoaderTest(getApplicationContext(), sdcardPath + File.separator + <span class="string">&quot;classes.dex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dexClassLoaderTest</span><span class="params">(Context context, String dexFilePath)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(dexFilePath, <span class="keyword">null</span>, <span class="keyword">null</span>, MainActivity.class.getClassLoader());</span><br><span class="line">            clazz = dexClassLoader.loadClass(<span class="string">&quot;com.example.dexclass.TestClass&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Method testFuncMethod = clazz.getDeclaredMethod(<span class="string">&quot;testFunc&quot;</span>);</span><br><span class="line">                Object obj = clazz.newInstance();</span><br><span class="line">                testFuncMethod.invoke(obj);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException | InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç ä¹Ÿä¸å¤æ‚ï¼Œé¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ªDexClassLoaderå¯¹è±¡ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå¯¹è±¡åŠ è½½TestClassç±»ï¼Œç„¶åæ‹¿åˆ°testFuncæ–¹æ³•ï¼Œæœ€åé€šè¿‡åå°„è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è¿™é‡Œä¸»è¦å…³æ³¨çš„æ˜¯DexClassLoaderè¿™ä¸ªç±»ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DexClassLoader</span> <span class="keyword">extends</span> <span class="title">BaseDexClassLoader</span> </span>&#123;</span><br><span class="line"><span class="number">36</span>    <span class="comment">/**</span></span><br><span class="line"><span class="comment">37     * Creates a &#123;<span class="doctag">@code</span> DexClassLoader&#125; that finds interpreted and native</span></span><br><span class="line"><span class="comment">38     * code.  Interpreted classes are found in a set of DEX files contained</span></span><br><span class="line"><span class="comment">39     * in Jar or APK files.</span></span><br><span class="line"><span class="comment">40     *</span></span><br><span class="line"><span class="comment">41     * &lt;p&gt;The path lists are separated using the character specified by the</span></span><br><span class="line"><span class="comment">42     * &#123;<span class="doctag">@code</span> path.separator&#125; system property, which defaults to &#123;<span class="doctag">@code</span> :&#125;.</span></span><br><span class="line"><span class="comment">43     *</span></span><br><span class="line"><span class="comment">44     * <span class="doctag">@param</span> dexPath the list of jar/apk files containing classes and</span></span><br><span class="line"><span class="comment">45     *     resources, delimited by &#123;<span class="doctag">@code</span> File.pathSeparator&#125;, which</span></span><br><span class="line"><span class="comment">46     *     defaults to &#123;<span class="doctag">@code</span> &quot;:&quot;&#125; on Android</span></span><br><span class="line"><span class="comment">47     * <span class="doctag">@param</span> optimizedDirectory this parameter is deprecated and has no effect since API level 26.</span></span><br><span class="line"><span class="comment">48     * <span class="doctag">@param</span> librarySearchPath the list of directories containing native</span></span><br><span class="line"><span class="comment">49     *     libraries, delimited by &#123;<span class="doctag">@code</span> File.pathSeparator&#125;; may be</span></span><br><span class="line"><span class="comment">50     *     &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">51     * <span class="doctag">@param</span> parent the parent class loader</span></span><br><span class="line"><span class="comment">52     */</span></span><br><span class="line"><span class="number">53</span>    <span class="function"><span class="keyword">public</span> <span class="title">DexClassLoader</span><span class="params">(String dexPath, String optimizedDirectory,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">54</span>            String librarySearchPath, ClassLoader parent)</span> </span>&#123;</span><br><span class="line"><span class="number">55</span>        <span class="keyword">super</span>(dexPath, <span class="keyword">null</span>, librarySearchPath, parent);</span><br><span class="line"><span class="number">56</span>    &#125;</span><br><span class="line"><span class="number">57</span>&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶æ„é€ å‡½æ•°éœ€è¦å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åŒ…å«èµ„æºæ–‡ä»¶çš„jar/apk/dexç­‰æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚æœæœ‰å¤šä¸ªè·¯å¾„ï¼Œé€šè¿‡:åˆ†éš”ã€‚ç¬¬äºŒä¸ªå‚æ•°å·²ç»åºŸå¼ƒã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºnativeåº“çš„è·¯å¾„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿæ˜¯ç½®ä¸ºnullã€‚æœ€åä¸€ä¸ªæ˜¯parentç±»åŠ è½½å™¨ï¼Œæˆ‘ä»¬è®¾ç½®ä¸ºå½“å‰ç±»åŠ è½½å™¨å³å¯ã€‚</p>
<p>å› ä¸ºç”¨åˆ°å¯¹sdcardçš„è¯»å†™ï¼Œæ‰€ä»¥éœ€è¦åœ¨AndroidManifest.xmlä¸­æ·»åŠ ç›¸åº”çš„æƒé™ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> <span class="attr">android:maxSdkVersion</span>=<span class="string">&quot;28&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç¨‹åºï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131409909.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image" title="">
                </div>
                <div class="image-caption">image</div>
            </figure>
<h3 id="è§£å†³ç¬¬äºŒä¸ªé—®é¢˜"><a href="#è§£å†³ç¬¬äºŒä¸ªé—®é¢˜" class="headerlink" title="è§£å†³ç¬¬äºŒä¸ªé—®é¢˜"></a>è§£å†³ç¬¬äºŒä¸ªé—®é¢˜</h3><p>å¦‚æœä¸è€ƒè™‘åŒäº²å§”æ´¾ä»¥åŠActivityç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ç”¨ç±»ä¼¼äºç¬¬ä¸€ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œé‡‡ç”¨DexClassLoaderåŠ è½½Activityç±»ï¼Œç„¶åä½¿ç”¨Intentç›´æ¥è®¿é—®è¿™ä¸ªActivityå‘¢ï¼Ÿè¯´å¹²å°±å¹²ã€‚</p>
<ol>
<li>ç”Ÿæˆä¸€ä¸ªç”¨æ¥æµ‹è¯•çš„dex</li>
</ol>
<p>æ–°å»ºä¸€ä¸ªTestActivityæ–‡ä»¶ï¼Œç„¶åè®©TestActivityç»§æ‰¿AppCompatActivtyï¼Œå¹¶é‡å†™onCreateæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        Log.d(<span class="string">&quot;TestActivity&quot;</span>, <span class="string">&quot;i am from TestActivity.onCreate&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œä»…ä»…æ˜¯æ‰“å°ä¸€æ¡æ—¥å¿—ã€‚</p>
<p>åŒæ ·åœ°ï¼Œæ‰“åŒ…è¯¥é¡¹ç›®ï¼Œå°†ç”Ÿæˆçš„apkè§£å‹ï¼Œå¾—åˆ°dexæ–‡ä»¶ï¼Œç„¶åå°†è¿™ä¸ªclasses.dexæ”¾åˆ°æ‰‹æœºçš„å†…å­˜å¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push classes3.dex /sdcard/</span><br></pre></td></tr></table></figure>
<ol>
<li>åŠ è½½å¹¶å¯åŠ¨Activity</li>
</ol>
<p>ç¼–è¾‘DexClassLoaderï¼Œä¿®æ”¹MainActivityä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        String sdcardPath = Environment.getExternalStorageDirectory().getAbsolutePath();</span><br><span class="line">        startActivityTest(<span class="keyword">this</span>, sdcardPath + File.separator + <span class="string">&quot;classes3.dex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityTest</span><span class="params">(Context context, String dexFilePath)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = <span class="keyword">null</span>;</span><br><span class="line">        DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(dexFilePath, <span class="keyword">null</span>, <span class="keyword">null</span>, MainActivity.class.getClassLoader());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            clazz = dexClassLoader.loadClass(<span class="string">&quot;com.example.dexclass.TestActivity&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        context.startActivity(<span class="keyword">new</span> Intent(context, clazz));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæœ‰ç”¨åˆ°<code>TestActivity</code>ï¼Œæ‰€ä»¥éœ€è¦åœ¨AndroidManifest.xmlä¸­å£°æ˜ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.dexclass.TestActivity&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œé¡¹ç›®ï¼Œåœ¨æ‰‹æœºè®¾ç½®ä¸­ç»™åº”ç”¨å¼€å¯sdcardè¯»å†™æƒé™ï¼Œç„¶åé‡æ–°æ‰§è¡Œï¼Œç»“æœæŠ¥é”™ï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201131612910.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="æ‰§è¡Œç»“æœ" title="">
                </div>
                <div class="image-caption">æ‰§è¡Œç»“æœ</div>
            </figure>
<p>æƒ³æƒ³ä¹Ÿä¸å¯èƒ½æˆåŠŸï¼Œè¦æ˜¯èƒ½è·Ÿé—®é¢˜ä¸€ä¸€æ ·è§£å†³ï¼Œé‚£è¿˜å«ä¸¤ä¸ªé—®é¢˜å—ğŸ¤ª</p>
<p>é‚£è¯¥å¦‚ä½•è§£å†³ç¬¬äºŒä¸ªé—®é¢˜å‘¢ï¼Ÿæ­¤æ—¶å°±å¾—ä»Activityçš„å¯åŠ¨æµç¨‹è¯´èµ·äº†ï¼Œä½†æ˜¯è¿™ç¯‡æ–‡ç« çš„ç›®çš„è¿˜æ˜¯ä»¥åŠ¨æ€åŠ è½½ä¸ºä¸»ï¼ŒActivityä»¥åŠAppçš„å¯åŠ¨æµç¨‹ä¼šæœ‰ä¸“é—¨çš„æ–‡ç« å»ä»‹ç»ï¼Œæœ¬æ–‡æœ€åç»™å‡ºçš„å‚è€ƒé“¾æ¥ï¼Œä¹Ÿä¼šæœ‰åŒ…å«Activityå¯åŠ¨æµç¨‹çš„ä»‹ç»ã€‚è¿™é‡ŒæŒ‘å‡ ä¸ªå…³é”®é“¾è·¯ä¸Šçš„å‡½æ•°ç®€å•è¯´ä¸‹åŸç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  Core implementation of activity launch. */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Activity <span class="title">performLaunchActivity</span><span class="params">(ActivityClientRecord r, Intent customIntent)</span> </span>&#123;</span><br><span class="line">    ActivityInfo aInfo = r.activityInfo;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (r.packageInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">        r.packageInfo = getPackageInfo(aInfo.applicationInfo, r.compatInfo,</span><br><span class="line">                Context.CONTEXT_INCLUDE_CODE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">    Activity activity = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        </span><br><span class="line">        java.lang.ClassLoader cl = appContext.getClassLoader();</span><br><span class="line">        activity = mInstrumentation.newActivity(</span><br><span class="line">                cl, component.getClassName(), r.intent);</span><br><span class="line">        StrictMode.incrementExpectedActivityCount(activity.getClass());</span><br><span class="line">        r.intent.setExtrasClassLoader(cl);</span><br><span class="line">        r.intent.prepareToEnterProcess();</span><br><span class="line">        <span class="keyword">if</span> (r.state != <span class="keyword">null</span>) &#123;</span><br><span class="line">            r.state.setClassLoader(cl);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mInstrumentation.onException(activity, e)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                <span class="string">&quot;Unable to instantiate activity &quot;</span> + component</span><br><span class="line">                + <span class="string">&quot;: &quot;</span> + e.toString(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> activity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹æ³¨é‡Šå°±çŸ¥é“ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¯åŠ¨Activityçš„æ ¸å¿ƒæ–¹æ³•ï¼Œåœ¨å¯åŠ¨Activityä¹‹å‰ä¼šé€šè¿‡è°ƒç”¨<code>getPackageInfo</code>æ–¹æ³•æ¥å…ˆè·å–å¹¶è§£æActivityä¿¡æ¯ï¼Œæˆ‘ä»¬è¿›åˆ°è¿™ä¸ªæ–¹æ³•ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> LoadedApk <span class="title">getPackageInfo</span><span class="params">(ApplicationInfo ai, CompatibilityInfo compatInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="keyword">int</span> flags)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> getPackageInfo(ai, compatInfo, <span class="keyword">null</span>, securityViolation, includeCode,</span><br><span class="line">                        registerPackage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  è¿™ä¸ªä¸‰ä¸ªå‚æ•°çš„<code>getPackageInfo</code>è°ƒç”¨äº†äº”ä¸ªå‚æ•°çš„<code>getPackageInfo</code>æ–¹æ³•ï¼Œæ³¨æ„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ çš„æ˜¯<code>null</code>ï¼Œæˆ‘ä»¬ç»§ç»­è¿›å…¥äº”ä¸ªå‚æ•°çš„<code>getPackageInfo</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> LoadedApk <span class="title">getPackageInfo</span><span class="params">(ApplicationInfo aInfo, CompatibilityInfo compatInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">        ClassLoader baseLoader, <span class="keyword">boolean</span> securityViolation, <span class="keyword">boolean</span> includeCode,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">boolean</span> registerPackage)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> differentUser = (UserHandle.myUserId() != UserHandle.getUserId(aInfo.uid));</span><br><span class="line">    <span class="keyword">synchronized</span> (mResourcesManager) &#123;</span><br><span class="line">        WeakReference&lt;LoadedApk&gt; ref;</span><br><span class="line">        <span class="keyword">if</span> (differentUser) &#123;</span><br><span class="line">            <span class="comment">// Caching not supported across users</span></span><br><span class="line">            ref = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (includeCode) &#123;</span><br><span class="line">            ref = mPackages.get(aInfo.packageName);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ref = mResourcePackages.get(aInfo.packageName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LoadedApk packageInfo = ref != <span class="keyword">null</span> ? ref.get() : <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (packageInfo == <span class="keyword">null</span> || (packageInfo.mResources != <span class="keyword">null</span></span><br><span class="line">                &amp;&amp; !packageInfo.mResources.getAssets().isUpToDate())) &#123;</span><br><span class="line">            <span class="keyword">if</span> (localLOGV) Slog.v(TAG, (includeCode ? <span class="string">&quot;Loading code package &quot;</span></span><br><span class="line">                    : <span class="string">&quot;Loading resource-only package &quot;</span>) + aInfo.packageName</span><br><span class="line">                    + <span class="string">&quot; (in &quot;</span> + (mBoundApplication != <span class="keyword">null</span></span><br><span class="line">                            ? mBoundApplication.processName : <span class="keyword">null</span>)</span><br><span class="line">                    + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            packageInfo =</span><br><span class="line">                <span class="keyword">new</span> LoadedApk(<span class="keyword">this</span>, aInfo, compatInfo, baseLoader,</span><br><span class="line">                        securityViolation, includeCode &amp;&amp;</span><br><span class="line">                        (aInfo.flags&amp;ApplicationInfo.FLAG_HAS_CODE) != <span class="number">0</span>, registerPackage);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (mSystemThread &amp;&amp; <span class="string">&quot;android&quot;</span>.equals(aInfo.packageName)) &#123;</span><br><span class="line">                packageInfo.installSystemApplicationInfo(aInfo,</span><br><span class="line">                        getSystemContext().mPackageInfo.getClassLoader());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> packageInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸€ä¸ªHashMapå³mPackagesç»´æŠ¤åŒ…åå’ŒLoadedApkçš„å¯¹åº”å…³ç³»ï¼Œå³æ¯ä¸€ä¸ªåº”ç”¨æœ‰ä¸€ä¸ªé”®å€¼å¯¹å¯¹åº”ï¼Œå¦‚æœä¸ºnullï¼Œå°±æ–°åˆ›å»ºä¸€ä¸ªLoadedApkå¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°Mapä¸­ã€‚ç¬¬ä¸€æ¬¡æ‰§è¡ŒActivityçš„æ—¶å€™ï¼Œå¾ˆæ˜¾ç„¶æ˜¯æ²¡æœ‰è¿™ä¸ªLoadedApkå¯¹è±¡çš„ï¼Œæ‰€ä»¥ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„LoadedApkå¯¹è±¡ï¼Œç„¶åæ³¨æ„åˆ°ä¼ å…¥äº†ä¸€ä¸ªbaseLoaderï¼Œæ­£æ˜¯ä¸Šé¢ä¼ çš„<code>null</code>ã€‚</p>
<p>æˆ‘ä»¬å†å›å¤´çœ‹ä¸‹<code>performLaunchActivity</code>ï¼Œå½“è°ƒç”¨å®Œ<code>getPackageInfo</code>ä¹‹åï¼Œä¼šè°ƒç”¨<code>java.lang.ClassLoader cl = appContext.getClassLoader();</code>å»è·å–<code>classLoader</code>ï¼Œæˆ‘ä»¬è¿›åˆ°<code>ContextImpl.getClassLoader</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClassLoader <span class="title">getClassLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mClassLoader != <span class="keyword">null</span> ? mClassLoader : (mPackageInfo != <span class="keyword">null</span> ? mPackageInfo.getClassLoader() : ClassLoader.getSystemClassLoader());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>mClassLoader</code>æ­£æ˜¯ä¸Šé¢ä¼ å…¥çš„<code>null</code>ï¼Œè€Œ<code>mPackageInfo</code>æ˜¯ä¸Šè¾¹ç”Ÿæˆçš„<code>LoadedApk</code>å¯¹è±¡ä¸ä¸ºç©ºï¼Œæ‰€ä»¥ä¼šè°ƒç”¨<code>LoadedApk</code>çš„<code>getClassLoader</code>æ–¹æ³•ã€‚è¿™é‡Œå°±ä¸åœ¨ä¸€å±‚ä¸€å±‚çš„å‰¥å¼€äº†ï¼Œå› ä¸ºæƒ³èŠ‚çœç‚¹ç¬”è¿¹ğŸ¤ªï¼Œæ€»ä¹‹ï¼Œç¿»æºç åˆ°æœ€åï¼Œä½ ä¼šå‘ç°æœ€ç»ˆæ˜¯é€šè¿‡è°ƒç”¨<code>ClassLoader.getSystemClassLoader</code>æ¥è·å–ä¸€ä¸ª<code>classLoader</code>ï¼Œè€Œè¿™ä¸ª<code>classLoader</code>æ­£å¥½æ˜¯<code>PathClassLoader</code>ã€‚</p>
<p>åˆ°è¿™é‡Œä¸€åˆ‡çœŸç›¸å¤§ç™½äº†å§ï¼Ÿå‰é¢<strong>æˆ‘ä»¬è™½ç„¶ç”¨<code>DexClassLoader</code>é€šè¿‡å¯¹APKçš„åŠ¨æ€åŠ è½½æˆåŠŸåŠ è½½äº†<code>TestActivity</code>åˆ°è™šæ‹Ÿæœºï¼Œä½†æ˜¯å½“ç³»ç»Ÿå¯åŠ¨è¯¥<code>Activity</code>çš„æ—¶å€™ï¼Œä¾ç„¶ä¼šå‡ºç°åŠ è½½ç±»å¤±è´¥çš„å¼‚å¸¸ï¼Œå› ä¸º<code>Activity</code>åœ¨å¯åŠ¨æ—¶ç”¨åˆ°çš„æ˜¯<code>PathClassLoader</code></strong>ã€‚å‰é¢åœ¨ä»‹ç»<code>Android</code>çš„<code>ClassLoader</code>çš„æ—¶å€™æåˆ°è¿‡ï¼Œ<code>PathClassLoader</code>æ˜¯<code>Android</code>é»˜è®¤ä½¿ç”¨çš„ç±»åŠ è½½å™¨ï¼Œä¸€ä¸ª<code>APK</code>ä¸­çš„<code>Activity</code>ç­‰ç±»ä¾¿æ˜¯åœ¨å…¶ä¸­åŠ è½½ï¼Œä½†æ˜¯æˆ‘ä»¬çš„<code>TestActivity</code>ä¸å­˜åœ¨äºå½“å‰çš„<code>APK</code>ï¼Œè€Œæ˜¯åœ¨å¤–éƒ¨çš„<code>dex</code>æ–‡ä»¶ä¸Šï¼Œè‡ªç„¶è€Œç„¶çš„å°±ä¼šå‡ºç°ä¸Šè¾¹æ‰¾ä¸åˆ°<code>Activity</code>çš„å¼‚å¸¸äº†ã€‚</p>
<p>é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ›¿æ¢æ‰è¿™ä¸ª<code>PathClassLoader</code>ä¸º<code>DexClassLoader</code>ä¸å°±å¥½äº†å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚é™¤äº†è¿™ä¸ªæ–¹æ¡ˆä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨åŒäº²å§”æ´¾çš„åŸç†ï¼Œç»™å‡ºå¦ä¸€ç§æ–¹æ¡ˆã€‚ä¸¤ç§è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>
<ul>
<li>æ›¿æ¢ç³»ç»Ÿç»„ä»¶ç±»åŠ è½½å™¨ä¸ºæˆ‘ä»¬çš„<code>DexClassLoader</code>ï¼ŒåŒæ—¶è®¾ç½®<code>DexClassLoader</code>çš„<code>parent</code>ä¸ºç³»ç»Ÿç»„ä»¶çš„ç±»åŠ è½½å™¨ã€‚</li>
<li>æ‰“ç ´åŸæœ‰çš„åŒäº²å…³ç³»ï¼Œåœ¨ç³»ç»Ÿç»„ä»¶ç±»åŠ è½½å™¨å’Œ<code>BootClassLoader</code>ä¸­æ’å…¥æˆ‘ä»¬è‡ªå·±çš„<code>DexClassLoader</code>å³å¯ã€‚</li>
</ul>
<h4 id="æ–¹æ¡ˆä¸€ï¼šæ›¿æ¢mClassLoaderä¸ºDexClassLoader"><a href="#æ–¹æ¡ˆä¸€ï¼šæ›¿æ¢mClassLoaderä¸ºDexClassLoader" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šæ›¿æ¢mClassLoaderä¸ºDexClassLoader"></a>æ–¹æ¡ˆä¸€ï¼šæ›¿æ¢<code>mClassLoader</code>ä¸º<code>DexClassLoader</code></h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201152137281.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image-20220115213655318" title="">
                </div>
                <div class="image-caption">image-20220115213655318</div>
            </figure>ä¿®æ”¹`MainActivity`çš„ä»£ç å¦‚ä¸‹ï¼š

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        String sdcardPath = Environment.getExternalStorageDirectory().getAbsolutePath();</span><br><span class="line">        startActivityTest(<span class="keyword">this</span>, sdcardPath + File.separator + <span class="string">&quot;classes3.dex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">replaceClassLoader</span><span class="params">(ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åŠ è½½ActivityThreadç±»</span></span><br><span class="line">            Class&lt;?&gt; ActivityThreadClazz = classLoader.loadClass(<span class="string">&quot;android.app.ActivityThread&quot;</span>);</span><br><span class="line">            <span class="comment">// è·å–currentActivityThreadæ–¹æ³•,ä»è€Œè·å–ActivityThreadå®ä¾‹</span></span><br><span class="line">            Method currentActivityThreadMethod = ActivityThreadClazz.getDeclaredMethod(<span class="string">&quot;currentActivityThread&quot;</span>);</span><br><span class="line">            currentActivityThreadMethod.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            Object activityThreadObj = currentActivityThreadMethod.invoke(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–ActivityThreadçš„mPackageå±æ€§</span></span><br><span class="line">            Field mPackageField = ActivityThreadClazz.getDeclaredField(<span class="string">&quot;mPackages&quot;</span>);</span><br><span class="line">            mPackageField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// è·å–loadedApkå¯¹è±¡</span></span><br><span class="line">            ArrayMap mPackageObj = (ArrayMap) mPackageField.get(activityThreadObj);</span><br><span class="line">            WeakReference wr = (WeakReference) mPackageObj.get(<span class="keyword">this</span>.getPackageName());</span><br><span class="line">            Object loadedApkObj = wr.get();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ›¿æ¢mClassLoader</span></span><br><span class="line">            Class loadedApkClazz = classLoader.loadClass(<span class="string">&quot;android.app.LoadedApk&quot;</span>);</span><br><span class="line">            Field mClassLoader = loadedApkClazz.getDeclaredField(<span class="string">&quot;mClassLoader&quot;</span>);</span><br><span class="line">            mClassLoader.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            mClassLoader.set(loadedApkObj, classLoader);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityTest</span><span class="params">(Context context, String dexFilePath)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = <span class="keyword">null</span>;</span><br><span class="line">        DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(dexFilePath, <span class="keyword">null</span>, <span class="keyword">null</span>, MainActivity.class.getClassLoader());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            replaceClassLoader(dexClassLoader);</span><br><span class="line">            clazz = dexClassLoader.loadClass(<span class="string">&quot;com.example.dexclass.TestActivity&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        context.startActivity(<span class="keyword">new</span> Intent(context, clazz));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œé¡¹ç›®ï¼Œç»“æœå¦‚é¢„æœŸï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201152139770.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image-20220115213932649" title="">
                </div>
                <div class="image-caption">image-20220115213932649</div>
            </figure>
<h4 id="æ–¹æ¡ˆäºŒï¼šåœ¨mClassLoaderå’ŒBootClassLoaderä¹‹é—´æ’å…¥DexClassLoader"><a href="#æ–¹æ¡ˆäºŒï¼šåœ¨mClassLoaderå’ŒBootClassLoaderä¹‹é—´æ’å…¥DexClassLoader" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šåœ¨mClassLoaderå’ŒBootClassLoaderä¹‹é—´æ’å…¥DexClassLoader"></a>æ–¹æ¡ˆäºŒï¼šåœ¨<code>mClassLoader</code>å’Œ<code>BootClassLoader</code>ä¹‹é—´æ’å…¥<code>DexClassLoader</code></h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201152147745.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image-20220115214708638" title="">
                </div>
                <div class="image-caption">image-20220115214708638</div>
            </figure>
<p>ä¿®æ”¹<code>TestActivity</code>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        Log.d(<span class="string">&quot;TestActivity&quot;</span>, <span class="string">&quot;i am from TestActivity.onCreate&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠ<code>AppCompatActivity</code>æ”¹ä¸ºäº†<code>Activity</code>ï¼Œé˜²æ­¢æœ‰ä¸€äº›ç±»é‡å¤åŠ è½½ã€‚</p>
<p>å†æ¬¡ä¿®æ”¹<code>MainActivity</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        String sdcardPath = Environment.getExternalStorageDirectory().getAbsolutePath();</span><br><span class="line">        startActivityTest(<span class="keyword">this</span>, sdcardPath + File.separator + <span class="string">&quot;classes3.dex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityTest</span><span class="params">(Context context, String dexFilePath)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = <span class="keyword">null</span>;</span><br><span class="line">        ClassLoader pathClassLoader = MainActivity.class.getClassLoader();</span><br><span class="line">        ClassLoader bootClassLoader = MainActivity.class.getClassLoader().getParent();</span><br><span class="line">        <span class="comment">// dexClassLoaderçš„parentä¸ºBootClassLoader</span></span><br><span class="line">        DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(dexFilePath, <span class="keyword">null</span>, <span class="keyword">null</span>, bootClassLoader);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field parentField = ClassLoader.class.getDeclaredField(<span class="string">&quot;parent&quot;</span>);</span><br><span class="line">            parentField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// å½“å‰ç»„ä»¶çš„ClassLoaderçš„parentä¸ºDexClassLoader</span></span><br><span class="line">            parentField.set(pathClassLoader, dexClassLoader);</span><br><span class="line">            clazz = dexClassLoader.loadClass(<span class="string">&quot;com.example.dexclass.TestActivity&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        context.startActivity(<span class="keyword">new</span> Intent(context, clazz));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œé¡¹ç›®ï¼Œç»“æœä¹Ÿå¦‚é¢„æœŸï¼š</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img.heshipeng.com/202201152315708.png?watermark/2/text/5YWz5rOo5b6u5L-h5YWs5LyX5Y-377ya6YCG5ZCR5LiA5q2l5q2l/font/5a6L5L2T/fontsize/300" alt="image-20220115231522507" title="">
                </div>
                <div class="image-caption">image-20220115231522507</div>
            </figure>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åŠ¨æ€åŠ è½½å°±æ˜¯ç”¨åˆ°çš„æ—¶å€™å†å»åŠ è½½ï¼Œä¹Ÿå«æ‡’åŠ è½½ï¼Œä¹Ÿå°±æ„å‘³ç€ç”¨ä¸åˆ°çš„æ—¶å€™æ˜¯ä¸ä¼šå»åŠ è½½çš„ã€‚åŠ¨æ€åŠ è½½æ˜¯dexåŠ å£³ï¼Œæ’ä»¶åŒ–ï¼Œçƒ­æ›´æ–°çš„åŸºç¡€ã€‚åŠ¨æ€åŠ è½½çš„dexä¸å…·æœ‰ç”Ÿå‘½å‘¨æœŸç‰¹å¾ï¼ŒAppä¸­çš„Activity, Serviceç­‰ç»„ä»¶æ— æ³•æ­£å¸¸å·¥ä½œï¼Œåªèƒ½å®Œæˆä¸€èˆ¬å‡½æ•°çš„è°ƒç”¨ï¼›éœ€è¦å¯¹ClassLoaderè¿›è¡Œä¿®æ­£ï¼ŒAppæ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œä¸¤ç§ä¿®æ­£æ–¹æ¡ˆï¼š</p>
<ol>
<li>æ›¿æ¢ç³»ç»Ÿç»„ä»¶ç±»åŠ è½½å™¨ä¸ºæˆ‘ä»¬çš„<code>DexClassLoader</code>ï¼ŒåŒæ—¶è®¾ç½®<code>DexClassLoader</code>çš„<code>parent</code>ä¸ºç³»ç»Ÿç»„ä»¶çš„ç±»åŠ è½½å™¨ã€‚</li>
<li>æ‰“ç ´åŸæœ‰çš„åŒäº²å…³ç³»ï¼Œåœ¨ç³»ç»Ÿç»„ä»¶ç±»åŠ è½½å™¨å’Œ<code>BootClassLoader</code>ä¸­æ’å…¥æˆ‘ä»¬è‡ªå·±çš„<code>DexClassLoader</code>å³å¯ã€‚</li>
</ol>
<h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cauchyweierstrass/article/details/51087198">AndroidåŠ¨æ€åŠ è½½ActivityåŸç†</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-252630.htm#msg_header_h2_6">FARTï¼šARTç¯å¢ƒä¸‹åŸºäºä¸»åŠ¨è°ƒç”¨çš„è‡ªåŠ¨åŒ–è„±å£³æ–¹æ¡ˆ</a></p>
<p><a target="_blank" rel="noopener" href="http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/app/ActivityThread.java">ActivityThreadæºç </a></p>
<p><a target="_blank" rel="noopener" href="https://samiu.top/2020/04/16/Activity%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E6%8E%A2%E7%A9%B6/">Activityçš„å¯åŠ¨æµç¨‹æ¢ç©¶</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000004062880">AndroidåŠ¨æ€åŠ è½½åŸºç¡€ ClassLoaderå·¥ä½œæœºåˆ¶</a></p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2022-03-03T02:16:58.820Z" itemprop="dateUpdated">2022-03-03 10:16:58</time>
</span><br>


        
        å…³æ³¨å¾®ä¿¡å…¬ä¼—å·~~é€†å‘ä¸€æ­¥æ­¥~~ï¼Œç¬¬ä¸€æ—¶é—´è·å–æ›´æ–°æ–‡ç« çš„æ¨é€ <br/> ç‰ˆæƒå£°æ˜ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        
    </div>
    
    <footer>
        <a href="https://blog.heshipeng.com">
            <img src="https://img.heshipeng.com/202205092042366.jpg" alt="æ‹¾å…‰çš„ç¢ç¾½">
            æ‹¾å…‰çš„ç¢ç¾½
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">èµ</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%80%86%E5%90%91/" rel="tag">é€†å‘</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/&title=ã€ŠAndroidé€†å‘ä¹‹åŠ¨æ€åŠ è½½ã€‹ â€” ä½•ä»•é¹çš„ä¸ªäººåšå®¢&pic=https://img.heshipeng.com/202205092042366.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/&title=ã€ŠAndroidé€†å‘ä¹‹åŠ¨æ€åŠ è½½ã€‹ â€” ä½•ä»•é¹çš„ä¸ªäººåšå®¢&source=ä¸“æ³¨äºçˆ¬è™«,æœºå™¨å­¦ä¹ ,æ·±åº¦å­¦ä¹ ,ç®—æ³•,åç«¯ç­‰é¢†åŸŸçš„å­¦ä¹ " data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠAndroidé€†å‘ä¹‹åŠ¨æ€åŠ è½½ã€‹ â€” ä½•ä»•é¹çš„ä¸ªäººåšå®¢&url=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/&via=https://blog.heshipeng.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3Dex%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ä¸€æ–‡äº†è§£Dexæ–‡ä»¶æ ¼å¼</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/%E5%A4%A7%E7%AB%AF%E8%BF%98%E6%98%AF%E5%B0%8F%E7%AB%AF/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">å¤§ç«¯è¿˜æ˜¯å°ç«¯ï¼Ÿ</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: '5167adeb62c9c9a59956',
          clientSecret: '8f4116c8b36633d863779e56e746184d2f795ae4',
          repo: 'beyond-heshipeng.github.io',
          owner: 'beyond-heshipeng',
          admin: ['beyond-heshipeng'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        è°¢è°¢å®è´~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="https://img.heshipeng.com/202205100208236.jpg" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="https://img.heshipeng.com/202205100208236.jpg" data-alipay="https://img.heshipeng.com/202205100209914.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        ç«™ç‚¹æ€»è®¿å®¢æ•°ï¼š<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        ç«™ç‚¹æ€»è®¿é—®é‡ï¼š<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>æ‹¾å…‰çš„ç¢ç¾½ &copy; 2021 - 2022</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">é„‚ICPå¤‡2022001140å·</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/&title=ã€ŠAndroidé€†å‘ä¹‹åŠ¨æ€åŠ è½½ã€‹ â€” ä½•ä»•é¹çš„ä¸ªäººåšå®¢&pic=https://img.heshipeng.com/202205092042366.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/&title=ã€ŠAndroidé€†å‘ä¹‹åŠ¨æ€åŠ è½½ã€‹ â€” ä½•ä»•é¹çš„ä¸ªäººåšå®¢&source=ä¸“æ³¨äºçˆ¬è™«,æœºå™¨å­¦ä¹ ,æ·±åº¦å­¦ä¹ ,ç®—æ³•,åç«¯ç­‰é¢†åŸŸçš„å­¦ä¹ " data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠAndroidé€†å‘ä¹‹åŠ¨æ€åŠ è½½ã€‹ â€” ä½•ä»•é¹çš„ä¸ªäººåšå®¢&url=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/&via=https://blog.heshipeng.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://blog.heshipeng.com/Android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.js?v=1.7.2" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<!--<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>-->
<script async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'æ­»é¬¼å»å“ªé‡Œäº†ï¼';
            clearTimeout(titleTime);
        } else {
            document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
